---
phase: 06.9-camera-matching
plan: 01
subsystem: cinematic
tags:
  - camera-matching
  - tracking
  - audio-sync
  - type-definitions
requires:
  - 06-foundation-cinematic
  - 06.1-camera-system
provides:
  - CameraMatchConfig dataclass
  - TrackingImportConfig dataclass
  - AudioSyncConfig dataclass
  - CameraProfile dataclass
  - Camera profile loader functions
affects:
  - 06.9-camera-matching (future plans)
tech-stack:
  added: []
  patterns:
    - dataclass serialization with to_dict/from_dict
    - preset loader pattern
key-files:
  created: []
  modified:
    - lib/cinematic/types.py
    - lib/cinematic/preset_loader.py
decisions:
  - date: 2026-02-19
    decision: CameraMatchConfig supports vanishing points as List[Tuple[float, float]]
    rationale: Flexible storage for 2D image coordinates detected from reference
  - date: 2026-02-19
    decision: TrackingImportConfig uses string format field instead of enum
    rationale: Easier YAML serialization and future extensibility
  - date: 2026-02-19
    decision: AudioSyncConfig uses Dict[str, int] for named markers
    rationale: Maps marker names to frame numbers for beat synchronization
  - date: 2026-02-19
    decision: CameraProfile stores lens distortion parameters as list
    rationale: Supports various distortion models with different coefficient counts
duration: 2m
completed: 2026-02-19
---

# Phase 06.9 Plan 01: Camera Matching Types Summary

## One-Liner

Camera matching and audio sync types with CameraMatchConfig, TrackingImportConfig, AudioSyncConfig, CameraProfile dataclasses and camera profile loaders.

## What Was Done

### Task 1: Add camera matching types to types.py

Added four new dataclasses to `/Users/bretbouchard/apps/blender_gsd/lib/cinematic/types.py`:

1. **CameraMatchConfig** - Configuration for matching Blender camera to reference images
   - `reference_image`: Path to reference image
   - `focal_length_estimate`: Estimated focal length (0 = auto)
   - `horizon_line`: Y position of horizon (0-1 normalized)
   - `vanishing_points`: List of detected/calculated vanishing points
   - `auto_detect_focal`, `auto_detect_horizon`: Auto-detection flags
   - `match_mode`: perspective, orthographic, or isometric
   - `tolerance`: Matching tolerance in pixels
   - `subject_bounds`: Optional bounding box for scale reference

2. **TrackingImportConfig** - Configuration for importing camera tracking data
   - `format`: Import format (nuke_chan, fbx, alembic, bvh, json)
   - `file_path`: Path to tracking data file
   - `frame_offset`: Frame number offset
   - `scale_factor`: Scale multiplier for imported data
   - `coordinate_system`: Source coordinate system (y_up, z_up)
   - `interpolate`: Interpolate between keyframes
   - `smooth_rotation`: Smoothing factor 0-1

3. **AudioSyncConfig** - Configuration for audio sync with beat markers
   - `audio_file`: Path to audio file
   - `bpm`: Beats per minute (0 = auto-detect)
   - `time_signature`: Tuple (numerator, denominator) default (4, 4)
   - `beat_markers`: List of frame numbers for beat markers
   - `auto_detect_bpm`: Auto BPM detection flag
   - `offset_frames`: Frame offset for sync
   - `markers`: Named markers dict (name -> frame)

4. **CameraProfile** - Camera device profile for realistic matching
   - `name`: Profile name
   - `sensor_width`, `sensor_height`: Sensor dimensions in mm
   - `focal_length`: Lens focal length in mm
   - `distortion_model`: none, simple, or brown_conrady
   - `distortion_params`: Distortion coefficients
   - `crop_factor`: Sensor crop factor
   - `aspect_ratio`: Pixel aspect ratio

### Task 2: Add camera profile loaders to preset_loader.py

Added to `/Users/bretbouchard/apps/blender_gsd/lib/cinematic/preset_loader.py`:

1. **CAMERA_PROFILE_ROOT** - Path constant for `configs/cinematic/tracking`

2. **get_camera_profile(name: str)** - Load a camera profile by name
   - Reads from `camera_profiles.yaml`
   - Returns profile dictionary
   - Raises FileNotFoundError if file missing
   - Raises ValueError if profile not found

3. **list_camera_profiles()** - List available camera profiles
   - Returns sorted list of profile names
   - Returns empty list if config file doesn't exist

## Verification Results

```
Camera matching types OK
Camera profile loader imports OK
```

## Files Modified

| File | Lines Changed | Purpose |
|------|---------------|---------|
| lib/cinematic/types.py | +229 | Added 4 dataclasses |
| lib/cinematic/preset_loader.py | +60 | Added constant and 2 functions |

## Commits

| Commit | Description |
|--------|-------------|
| fa52ba1 | feat(06.9-01): add camera matching and audio sync types |
| 93edfd0 | feat(06.9-01): add camera profile loaders |

## Deviations from Plan

None - plan executed exactly as written.

## Next Phase Readiness

- Camera matching types ready for use by camera_match.py module (future plan)
- Audio sync types ready for use by animation system integration
- Profile loaders ready for camera_profiles.yaml configuration file
