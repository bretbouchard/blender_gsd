---
phase: 06.4-color-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/cinematic/types.py
  - lib/cinematic/enums.py
  - lib/cinematic/preset_loader.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "ColorConfig dataclass exists with view_transform, exposure, gamma, look, working_color_space properties"
    - "LUTConfig dataclass exists with name, lut_path, intensity, enabled properties"
    - "ExposureLockConfig dataclass exists with target_gray, highlight_protection, shadow_protection"
    - "Color preset loaders can load view_transform, technical_lut, and film_lut presets"
    - "Working color space (AgX, ACESsg, Filmic, Standard) is configurable via ColorConfig"
  artifacts:
    - path: "lib/cinematic/types.py"
      provides: "Color configuration dataclasses"
      contains: "class ColorConfig"
    - path: "lib/cinematic/types.py"
      provides: "LUT configuration dataclass"
      contains: "class LUTConfig"
    - path: "lib/cinematic/types.py"
      provides: "Exposure lock configuration"
      contains: "class ExposureLockConfig"
    - path: "lib/cinematic/preset_loader.py"
      provides: "Color preset loading functions"
      exports: ["get_color_preset", "get_technical_lut_preset", "get_film_lut_preset"]
  key_links:
    - from: "lib/cinematic/types.py"
      to: "configs/cinematic/color/color_management_presets.yaml"
      via: "preset_loader.py"
      pattern: "get_color_preset"
---

<objective>
Extend types.py with ColorConfig, LUTConfig, ExposureLockConfig dataclasses and add color preset loaders to preset_loader.py.

Purpose: Establish the data structures and preset loading functions required for the color pipeline system. These types will be used by the color.py module in Wave 2.

Output: Extended types.py with 3 new dataclasses, new enums if needed, and color preset loader functions in preset_loader.py.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Research and existing patterns
@.planning/phases/06.4-color-pipeline/06.4-RESEARCH.md
@lib/cinematic/types.py
@lib/cinematic/enums.py
@lib/cinematic/preset_loader.py
@configs/cinematic/color/color_management_presets.yaml
@configs/cinematic/color/technical_luts.yaml
@configs/cinematic/color/film_luts.yaml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add ColorConfig, LUTConfig, ExposureLockConfig to types.py</name>
  <files>lib/cinematic/types.py</files>
  <action>
Add three new dataclasses to lib/cinematic/types.py following the established pattern (to_dict, from_dict methods).

1. **ColorConfig dataclass:**
   - view_transform: str = "AgX" (options: Standard, AgX, Filmic, Filmic Log, Raw, Log, ACESsg)
   - exposure: float = 0.0 (range: -inf to +inf)
   - gamma: float = 1.0 (range: 0 to 5)
   - look: str = "None" (e.g., "AgX Default Medium High Contrast", "Filmic Medium High Contrast")
   - display_device: str = "sRGB"
   - working_color_space: str = "AgX" (options: AgX, ACEScg, Filmic, Standard - this is the scene linear color space used for internal operations, configured via Blender's render properties)
   - Include to_dict() and from_dict() methods

   **Note on working_color_space:** This field represents the internal scene linear color space. In Blender, this is typically managed via the Scene > Color Management > Render Space setting. The working space determines how color math is performed internally. Common options:
   - AgX: Blender 4.x default, handles HDR well
   - ACEScg: Industry standard for VFX
   - Filmic: Legacy Blender option
   - Standard: sRGB linear, for simpler workflows

   The working_color_space is configured via Blender's render settings (not view transform). View transform presets may recommend a specific working space.

2. **LUTConfig dataclass:**
   - name: str (preset name)
   - lut_path: str (path to .cube file)
   - intensity: float = 0.8 (default per REQ-CINE-LUT)
   - enabled: bool = True
   - lut_type: str = "creative" (options: technical, film, creative)
   - precision: int = 33 (33 for film, 65 for technical)
   - Include to_dict() and from_dict() methods

3. **ExposureLockConfig dataclass:**
   - enabled: bool = False
   - target_gray: float = 0.18 (18% gray targeting per requirements)
   - highlight_protection: float = 0.95 (max highlight value)
   - shadow_protection: float = 0.02 (min shadow value)
   - Include to_dict() and from_dict() methods

Place these after the existing dataclasses (after MultiCameraLayout). Follow the exact pattern used by existing dataclasses like GelConfig and HDRIConfig.
  </action>
  <verify>
grep -c "class ColorConfig" lib/cinematic/types.py && \
grep -c "class LUTConfig" lib/cinematic/types.py && \
grep -c "class ExposureLockConfig" lib/cinematic/types.py && \
grep -c "working_color_space" lib/cinematic/types.py
  </verify>
  <done>
ColorConfig, LUTConfig, and ExposureLockConfig dataclasses exist in types.py with to_dict and from_dict methods. ColorConfig includes working_color_space field.
</done>
</task>

<task type="auto">
  <name>Task 2: Add ViewTransform enum to enums.py</name>
  <files>lib/cinematic/enums.py</files>
  <action>
Add new enums to lib/cinematic/enums.py following the established pattern.

1. **ViewTransform enum:**
   - STANDARD = "Standard"
   - AGX = "AgX"
   - FILMIC = "Filmic"
   - FILMIC_LOG = "Filmic Log"
   - RAW = "Raw"
   - LOG = "Log"
   - ACESCG = "ACEScg"

2. **WorkingColorSpace enum:**
   - AGX = "AgX"
   - ACESCG = "ACEScg"
   - FILMIC = "Filmic"
   - STANDARD = "Standard"

Add after the existing EasingType enum. These enums provide type-safe view transform and working space selection matching Blender's OCIO options.
  </action>
  <verify>
grep -c "class ViewTransform" lib/cinematic/enums.py && \
grep -c "class WorkingColorSpace" lib/cinematic/enums.py
  </verify>
  <done>
ViewTransform and WorkingColorSpace enums exist in enums.py with all required options.
</done>
</task>

<task type="auto">
  <name>Task 3: Add color preset loaders to preset_loader.py</name>
  <files>lib/cinematic/preset_loader.py</files>
  <action>
Add color preset loader functions to lib/cinematic/preset_loader.py following the established pattern.

1. **Add COLOR_CONFIG_ROOT constant:**
   ```python
   COLOR_CONFIG_ROOT = Path("configs/cinematic/color")
   ```

2. **Add get_color_preset(name: str) function:**
   - Load from COLOR_CONFIG_ROOT / "color_management_presets.yaml"
   - Access presets[name] from the loaded data
   - Raise ValueError with available presets if not found
   - Follow exact pattern of get_hdri_preset()

3. **Add get_technical_lut_preset(name: str) function:**
   - Load from COLOR_CONFIG_ROOT / "technical_luts.yaml"
   - Access technical[name] from the loaded data
   - Raise ValueError with available presets if not found

4. **Add get_film_lut_preset(name: str) function:**
   - Load from COLOR_CONFIG_ROOT / "film_luts.yaml"
   - Access film[name] from the loaded data
   - Raise ValueError with available presets if not found

5. **Add list functions:**
   - list_color_presets() - list presets from color_management_presets.yaml
   - list_technical_lut_presets() - list from technical_luts.yaml
   - list_film_lut_presets() - list from film_luts.yaml

Place these after the Backdrop System Preset Loaders section (add a new Color System Preset Loaders section).
  </action>
  <verify>
grep -c "def get_color_preset" lib/cinematic/preset_loader.py && \
grep -c "def get_technical_lut_preset" lib/cinematic/preset_loader.py && \
grep -c "def get_film_lut_preset" lib/cinematic/preset_loader.py && \
grep -c "COLOR_CONFIG_ROOT" lib/cinematic/preset_loader.py
  </verify>
  <done>
Color preset loader functions exist in preset_loader.py with get_color_preset, get_technical_lut_preset, get_film_lut_preset and corresponding list functions.
</done>
</task>

</tasks>

<verification>
1. Verify types.py contains all 3 new dataclasses with proper to_dict/from_dict methods
2. Verify ColorConfig includes working_color_space field
3. Verify enums.py contains ViewTransform and WorkingColorSpace enums
4. Verify preset_loader.py contains all color preset loader functions
5. Verify COLOR_CONFIG_ROOT is defined in preset_loader.py
</verification>

<success_criteria>
- ColorConfig dataclass exists with view_transform, exposure, gamma, look, display_device, working_color_space properties
- LUTConfig dataclass exists with name, lut_path, intensity, enabled, lut_type, precision properties
- ExposureLockConfig dataclass exists with enabled, target_gray, highlight_protection, shadow_protection
- ViewTransform enum exists with all Blender view transform options
- WorkingColorSpace enum exists with AgX, ACEScg, Filmic, Standard options
- get_color_preset(), get_technical_lut_preset(), get_film_lut_preset() functions exist
- list_color_presets(), list_technical_lut_presets(), list_film_lut_presets() functions exist
</success_criteria>

<output>
After completion, create `.planning/phases/06.4-color-pipeline/06.4-01-SUMMARY.md`
</output>
