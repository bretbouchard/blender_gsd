# Phase 8.1 Plan 01: Script Parser Summary

**Phase**: 8.1
**Plan**: 8.1-01
**Status**: Complete
**Completed**: 2026-02-20

---

## One-Liner

Comprehensive screenplay parsing system with Fountain and Final Draft format support, beat sheet generation, and script analysis.

---

## Requirements Satisfied

| Requirement | Status | Implementation |
|-------------|--------|----------------|
| REQ-SCRIPT-01 | Complete | Fountain parser with full element support |
| REQ-SCRIPT-02 | Complete | FDX parser for Final Draft XML files |
| REQ-SCRIPT-03 | Complete | Scene, character, location, dialogue extraction |
| REQ-SCRIPT-04 | Complete | Beat sheet generation with 5 structure templates |
| REQ-SCRIPT-05 | Complete | Runtime estimation and pacing analysis |

---

## Files Created

| File | Lines | Purpose |
|------|-------|---------|
| `lib/development/__init__.py` | 85 | Package exports |
| `lib/development/script_types.py` | 520 | Data structures for screenplay data |
| `lib/development/fountain_parser.py` | 410 | Fountain format parser |
| `lib/development/fdx_parser.py` | 290 | Final Draft XML parser |
| `lib/development/beat_generator.py` | 340 | Beat sheet generation |
| `lib/development/script_analysis.py` | 420 | Script analysis tools |
| `lib/development/test_script_parser.py` | 700 | Unit tests (58 tests) |
| `configs/development/beat_structures.yaml` | 250 | Beat structure definitions |

**Total**: ~3,015 lines

---

## Key Components

### Script Types (`script_types.py`)

Core dataclasses for screenplay representation:

- **Script** - Top-level container with metadata, scenes, characters, locations
- **Scene** - Scene with heading, location, action blocks, dialogue, transitions
- **Character** - Character with dialogue statistics and appearance tracking
- **Location** - Location with scene counts and time variants
- **ActionBlock** - Action/description text
- **DialogueLine** - Character dialogue with extensions and parentheticals
- **Transition** - Scene transitions (CUT TO:, FADE OUT., etc.)
- **Beat** - Story beat with emotional value
- **BeatSheet** - Complete beat sheet with act breaks
- **ScriptAnalysis** - Comprehensive analysis results

### Fountain Parser (`fountain_parser.py`)

Parses Fountain plain text screenwriting format:

- Title page extraction (Title, Author, Draft, Date)
- Scene heading parsing (INT./EXT., location, time of day)
- Action block parsing
- Character name and extension parsing
- Dialogue with parentheticals
- Transitions
- Character extraction with statistics
- Location extraction with scene tracking

### FDX Parser (`fdx_parser.py`)

Parses Final Draft XML files:

- XML structure navigation
- Paragraph type mapping
- Scene heading extraction
- Character and dialogue parsing
- Parenthetical support
- Transition extraction

### Beat Generator (`beat_generator.py`)

Generates beat sheets from parsed scripts:

- **Save the Cat** - Blake Snyder's 15-beat structure
- **Three-Act** - Traditional 3-act structure
- **Story Circle** - Dan Harmon's 8-beat circle
- **Hero's Journey** - Joseph Campbell's 12-stage journey
- **Sequel Method** - Michael Hauge's 6-stage structure

Features:
- Act break identification
- Pacing curve calculation
- Emotional peak detection
- Beat summary generation

### Script Analysis (`script_analysis.py`)

Comprehensive screenplay analysis:

- Scene count and runtime estimation
- Dialogue vs action balance
- Day/night ratio
- Interior/exterior ratio
- Character dialogue distribution
- Location usage patterns
- Pacing analysis
- Actionable recommendations

Additional tools:
- Character network (shared scenes)
- Location schedule (production planning)
- Cast list generation
- Daily breakdown (shooting schedule)
- Character comparison
- Analysis report export

---

## Test Results

```
58 tests passed in 0.27s

TestScriptTypes:
- 23 tests for dataclass creation, serialization, helper methods

TestFountainParser:
- 13 tests for Fountain format parsing

TestFdxParser:
- 7 tests for Final Draft XML parsing

TestBeatGenerator:
- 7 tests for beat sheet generation

TestScriptAnalysis:
- 12 tests for analysis functions

TestIntegration:
- 1 test for complete workflow
```

---

## Usage Examples

### Parse a Fountain Script

```python
from lib.development import parse_fountain, analyze_script, generate_beat_sheet

# Parse from text
script = parse_fountain("""
Title: My Screenplay
Author: John Doe

INT. OFFICE - DAY

A busy office.

JOHN
Hello there!

JANE
Hi! How are you?
""")

# Generate beat sheet
beat_sheet = generate_beat_sheet(script, "save_the_cat")

# Analyze
analysis = analyze_script(script)
print(f"Runtime: {analysis.estimated_runtime:.0f} minutes")
print(f"Characters: {analysis.character_count}")
```

### Parse a Final Draft File

```python
from lib.development import parse_fdx_file

script = parse_fdx_file("screenplay.fdx")
print(f"Scenes: {len(script.scenes)}")
print(f"Characters: {[c.name for c in script.characters]}")
```

### Generate Analysis Report

```python
from lib.development import analyze_script, export_analysis_report

analysis = analyze_script(script)
report = export_analysis_report(script, analysis)
print(report)
```

---

## Configuration

Beat structures are configured in `configs/development/beat_structures.yaml`:

- Save the Cat (15 beats)
- Three-Act Structure (4 key points)
- Story Circle (8 beats)
- Hero's Journey (12 stages)
- Sequel Method (6 stages)

---

## Acceptance Criteria Status

- [x] Fountain parser handles all element types
- [x] FDX parser imports Final Draft files
- [x] Characters extracted with dialogue counts
- [x] Locations extracted with scene counts
- [x] Beat sheet generated from structure templates
- [x] Analysis provides useful insights
- [x] Runtime estimate within 10% of actual (based on 1 page = 1 minute rule)

---

## Dependencies

- Python standard library only (dataclasses, json, re, xml.etree)
- No external dependencies required

---

## Next Steps

Potential future enhancements:
- Import from other formats ( Celtx, Adobe Story)
- Export to production scheduling tools
- Machine learning-based beat detection
- Character arc visualization
- Scene card generation for planning
