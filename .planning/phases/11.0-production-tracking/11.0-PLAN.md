# Phase 11.0: Production Tracking Dashboard

**Goal**: Build a simple TypeScript UI to VIEW all production elements with status, blockers, and source traceability.

**Requirements**: `.planning/REQUIREMENTS_PRODUCTION_TRACKING.md` (REQ-TRACK-01, REQ-TRACK-03)

**Duration**: 2-3 hours

---

## Overview

A **read-only** tracking dashboard that:
- Shows ALL items in one place
- Displays status (complete/in_progress/planned/vague/blocked)
- Links everything to source
- Works with YAML files (no database)
- **AI-mediated writes**: No CRUD UI - talk to AI to make changes

**Philosophy**: If we need fancy UI tools, we're doing it wrong. Keep it simple, uniform, fluid.

**Write Model**: The UI is read-only. To add/edit items, talk to Claude with context like:
> "Add a new character CHAR-003 named 'Villain' with status planned"
> "Mark WARD-015 as complete"
> "Add blocker to PROP-003: waiting on concept approval"

The AI edits the YAML files directly. No backend needed.

---

## Architecture

```
tracking-ui/
‚îú‚îÄ‚îÄ index.html              # Entry point
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ main.ts             # App bootstrap
‚îÇ   ‚îú‚îÄ‚îÄ types.ts            # TypeScript interfaces
‚îÇ   ‚îú‚îÄ‚îÄ api.ts              # YAML file loading (read-only)
‚îÇ   ‚îú‚îÄ‚îÄ store.ts            # In-memory state
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Board.ts        # Kanban view
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Table.ts        # Table view (optional)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ItemCard.ts     # Item display card
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ItemDetail.ts   # Item detail modal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ FilterBar.ts    # Status/category filter
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BlockerPanel.ts # Blocker display
‚îÇ   ‚îî‚îÄ‚îÄ styles/
‚îÇ       ‚îî‚îÄ‚îÄ main.css        # Minimal styling
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ vite.config.ts
‚îî‚îÄ‚îÄ tsconfig.json

.planning/tracking/
‚îú‚îÄ‚îÄ items/                  # Individual item YAML files
‚îÇ   ‚îú‚îÄ‚îÄ CHAR-001.yaml
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ blockers.yaml           # Active blockers
‚îî‚îÄ‚îÄ config.yaml             # Categories, statuses
```

**Note**: No ItemForm.ts - this is read-only. AI edits YAML files directly.

---

## Data Model

### Item Schema (YAML)
```yaml
# .planning/tracking/items/CHAR-001.yaml
id: CHAR-001
name: "Hero Character"
category: character
status: in_progress
description: "Main protagonist of the story"
source:
  spec: specs/characters/hero.md
  created_by: bret
  created_at: 2026-02-19
blockers: []
depends_on: []
assigned_to: null
notes: "Concept approved, modeling in progress"
images:
  - .gsd-state/onesheets/CHAR-001-hero.png
onesheet: .gsd-state/onesheets/CHAR-001.html
```

### Config Schema
```yaml
# .planning/tracking/config.yaml
categories:
  - id: character
    name: Characters
    color: "#3498db"
  - id: wardrobe
    name: Wardrobe
    color: "#9b59b6"
  - id: prop
    name: Props
    color: "#e67e22"
  - id: set
    name: Sets
    color: "#27ae60"
  - id: shot
    name: Shots
    color: "#e74c3c"
  - id: asset
    name: Assets
    color: "#1abc9c"
  - id: audio
    name: Audio
    color: "#f39c12"

statuses:
  - id: complete
    name: Complete
    color: "#27ae60"
  - id: in_progress
    name: In Progress
    color: "#f1c40f"
  - id: planned
    name: Planned
    color: "#3498db"
  - id: vague
    name: Vague
    color: "#95a5a6"
  - id: blocked
    name: Blocked
    color: "#e74c3c"
```

---

## Tasks

### Task 1: Project Setup
**File**: `tracking-ui/package.json`, `vite.config.ts`, `tsconfig.json`

Create Vite + TypeScript project:
```bash
cd tracking-ui
npm init -y
npm install vite typescript @types/node
npx tsc --init
```

Vite config for YAML loading:
```typescript
// vite.config.ts
import { defineConfig } from 'vite'
import yaml from '@rollup/plugin-yaml'

export default defineConfig({
  plugins: [yaml()],
  server: {
    port: 3000
  }
})
```

**Acceptance**: `npm run dev` starts dev server

---

### Task 2: Type Definitions
**File**: `tracking-ui/src/types.ts`

```typescript
export interface Source {
  spec?: string;
  task?: string;
  commit?: string;
  created_by: string;
  created_at: string;
  regenerated_from?: string;
}

export interface TrackingItem {
  id: string;
  name: string;
  category: string;
  status: Status;
  description?: string;
  source: Source;
  blockers: string[];
  depends_on: string[];
  assigned_to?: string;
  notes?: string;
  images: string[];
  onesheet?: string;
}

export type Status = 'complete' | 'in_progress' | 'planned' | 'vague' | 'blocked';

export interface Category {
  id: string;
  name: string;
  color: string;
}

export interface StatusConfig {
  id: Status;
  name: string;
  color: string;
}

export interface TrackingConfig {
  categories: Category[];
  statuses: StatusConfig[];
}
```

**Acceptance**: Types compile without errors

---

### Task 3: Mock Data Files
**Files**: `.planning/tracking/items/*.yaml`, `.planning/tracking/config.yaml`

Create sample data:
- 3 characters at different statuses
- 2 wardrobe items
- 2 props
- 1 shot
- 1 blocker

**Acceptance**: All YAML files valid, loadable

---

### Task 4: API Layer (File Operations)
**File**: `tracking-ui/src/api.ts`

```typescript
import type { TrackingItem, TrackingConfig } from './types';

// For Vite dev, we'll import YAML directly
// In production, these would be API calls

export async function loadConfig(): Promise<TrackingConfig> {
  const config = await import('../../.planning/tracking/config.yaml');
  return config.default || config;
}

export async function loadItems(): Promise<TrackingItem[]> {
  // Vite glob import for all item files
  const modules = import.meta.glob('../../.planning/tracking/items/*.yaml');
  const items: TrackingItem[] = [];

  for (const path in modules) {
    const mod = await modules[path]();
    items.push((mod as any).default || mod);
  }

  return items;
}

// For write operations, we'd need a simple backend
// For now, this is read-only in the browser
// Could use Vite's file-watching + simple API server later
```

**Acceptance**: `loadItems()` returns array of items

---

### Task 5: Store (In-Memory State)
**File**: `tracking-ui/src/store.ts`

Simple reactive store using signals pattern:

```typescript
type Subscriber<T> = (value: T) => void;

class Signal<T> {
  private value: T;
  private subscribers: Subscriber<T>[] = [];

  constructor(initial: T) {
    this.value = initial;
  }

  get(): T {
    return this.value;
  }

  set(newValue: T): void {
    this.value = newValue;
    this.subscribers.forEach(s => s(newValue));
  }

  subscribe(fn: Subscriber<T>): () => void {
    this.subscribers.push(fn);
    return () => {
      this.subscribers = this.subscribers.filter(s => s !== fn);
    };
  }
}

export const items = new Signal<TrackingItem[]>([]);
export const config = new Signal<TrackingConfig | null>(null);
export const filters = new Signal<{ status?: Status; category?: string }>({});
export const view = new Signal<'kanban' | 'table'>('kanban');

// Derived signal for filtered items
export function getFilteredItems(): TrackingItem[] {
  const allItems = items.get();
  const currentFilters = filters.get();

  return allItems.filter(item => {
    if (currentFilters.status && item.status !== currentFilters.status) {
      return false;
    }
    if (currentFilters.category && item.category !== currentFilters.category) {
      return false;
    }
    return true;
  });
}
```

**Acceptance**: Store updates trigger re-renders

---

### Task 6: Board Component (Kanban View)
**File**: `tracking-ui/src/components/Board.ts`

Columns for each status, items as cards:

```typescript
import { getFilteredItems, config } from '../store';
import { ItemCard } from './ItemCard';

export function Board(): HTMLElement {
  const container = document.createElement('div');
  container.className = 'board';

  function render() {
    const cfg = config.get();
    const items = getFilteredItems();

    if (!cfg) return;

    container.innerHTML = '';

    cfg.statuses.forEach(status => {
      const column = document.createElement('div');
      column.className = 'board-column';
      column.style.setProperty('--status-color', status.color);

      const header = document.createElement('div');
      header.className = 'column-header';
      header.innerHTML = `
        <h3>${status.name}</h3>
        <span class="count">${items.filter(i => i.status === status.id).length}</span>
      `;
      column.appendChild(header);

      const content = document.createElement('div');
      content.className = 'column-content';

      items
        .filter(i => i.status === status.id)
        .forEach(item => {
          content.appendChild(ItemCard(item));
        });

      column.appendChild(content);
      container.appendChild(column);
    });
  }

  render();

  // Subscribe to changes
  items.subscribe(render);
  filters.subscribe(render);

  return container;
}
```

**Acceptance**: Kanban board renders with columns

---

### Task 7: Item Card Component
**File**: `tracking-ui/src/components/ItemCard.ts`

```typescript
import type { TrackingItem } from '../types';
import { config } from '../store';

export function ItemCard(item: TrackingItem): HTMLElement {
  const cfg = config.get();
  const category = cfg?.categories.find(c => c.id === item.category);

  const card = document.createElement('div');
  card.className = 'item-card';
  card.dataset.id = item.id;

  card.innerHTML = `
    <div class="item-header">
      <span class="item-category" style="background: ${category?.color}">${category?.name}</span>
      <span class="item-id">${item.id}</span>
    </div>
    <h4 class="item-name">${item.name}</h4>
    ${item.description ? `<p class="item-description">${item.description}</p>` : ''}
    ${item.images.length > 0 ? `<img src="${item.images[0]}" class="item-thumb" />` : ''}
    ${item.blockers.length > 0 ? `<div class="item-blocked">‚ö†Ô∏è ${item.blockers.length} blocker(s)</div>` : ''}
    <div class="item-footer">
      <a href="${item.source.spec}" class="source-link">View Source ‚Üí</a>
    </div>
  `;

  card.addEventListener('click', () => {
    // Open item detail modal
    console.log('Open item:', item.id);
  });

  return card;
}
```

**Acceptance**: Cards render with all info

---

### Task 8: Filter Bar Component
**File**: `tracking-ui/src/components/FilterBar.ts`

```typescript
import { config, filters, view } from '../store';

export function FilterBar(): HTMLElement {
  const container = document.createElement('div');
  container.className = 'filter-bar';

  function render() {
    const cfg = config.get();
    const currentFilters = filters.get();
    const currentView = view.get();

    container.innerHTML = `
      <div class="filters">
        <select id="status-filter">
          <option value="">All Statuses</option>
          ${cfg?.statuses.map(s => `
            <option value="${s.id}" ${currentFilters.status === s.id ? 'selected' : ''}>
              ${s.name}
            </option>
          `).join('')}
        </select>

        <select id="category-filter">
          <option value="">All Categories</option>
          ${cfg?.categories.map(c => `
            <option value="${c.id}" ${currentFilters.category === c.id ? 'selected' : ''}>
              ${c.name}
            </option>
          `).join('')}
        </select>

        <input type="text" id="search" placeholder="Search items..." />
      </div>

      <div class="view-toggle">
        <button class="${currentView === 'kanban' ? 'active' : ''}" data-view="kanban">Board</button>
        <button class="${currentView === 'table' ? 'active' : ''}" data-view="table">Table</button>
      </div>
    `;

    // Event handlers
    container.querySelector('#status-filter')?.addEventListener('change', (e) => {
      const value = (e.target as HTMLSelectElement).value as Status;
      filters.set({ ...currentFilters, status: value || undefined });
    });

    container.querySelector('#category-filter')?.addEventListener('change', (e) => {
      const value = (e.target as HTMLSelectElement).value;
      filters.set({ ...currentFilters, category: value || undefined });
    });

    container.querySelectorAll('[data-view]').forEach(btn => {
      btn.addEventListener('click', (e) => {
        view.set((e.target as HTMLElement).dataset.view as 'kanban' | 'table');
      });
    });
  }

  render();
  config.subscribe(render);

  return container;
}
```

**Acceptance**: Filters work, view toggle works

---

### Task 9: Blocker Panel Component
**File**: `tracking-ui/src/components/BlockerPanel.ts`

```typescript
import { items } from '../store';

export function BlockerPanel(): HTMLElement {
  const container = document.createElement('div');
  container.className = 'blocker-panel';

  function render() {
    const allItems = items.get();
    const blockedItems = allItems.filter(i => i.blockers.length > 0);

    container.innerHTML = `
      <h3>‚ö†Ô∏è Blockers (${blockedItems.length})</h3>
      ${blockedItems.length === 0 ? '<p class="empty">No blockers! üéâ</p>' : ''}
      <ul class="blocker-list">
        ${blockedItems.map(item => `
          <li class="blocker-item">
            <strong>${item.id}</strong>: ${item.name}
            <span class="blocker-count">${item.blockers.length} blocker(s)</span>
          </li>
        `).join('')}
      </ul>
    `;
  }

  render();
  items.subscribe(render);

  return container;
}
```

**Acceptance**: Blocker panel shows blocked items

---

### Task 10: Main App Bootstrap
**File**: `tracking-ui/src/main.ts`

```typescript
import './styles/main.css';
import { loadConfig, loadItems } from './api';
import { config, items } from './store';
import { FilterBar } from './components/FilterBar';
import { Board } from './components/Board';
import { BlockerPanel } from './components/BlockerPanel';

async function init() {
  // Load data
  const [cfg, allItems] = await Promise.all([
    loadConfig(),
    loadItems()
  ]);

  config.set(cfg);
  items.set(allItems);

  // Build UI
  const app = document.getElementById('app')!;
  app.innerHTML = '';

  const header = document.createElement('header');
  header.innerHTML = '<h1>Production Tracking</h1>';
  app.appendChild(header);

  app.appendChild(FilterBar());

  const main = document.createElement('main');
  main.className = 'main-content';
  main.appendChild(Board());
  main.appendChild(BlockerPanel());
  app.appendChild(main);
}

init().catch(console.error);
```

**Acceptance**: App loads and renders

---

### Task 11: Styles
**File**: `tracking-ui/src/styles/main.css`

Minimal CSS, no framework:

```css
:root {
  --bg: #1a1a2e;
  --fg: #eaeaea;
  --muted: #666;
  --accent: #3498db;
  --card: #16213e;
  --border: #2a2a4a;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: var(--bg);
  color: var(--fg);
  min-height: 100vh;
}

#app {
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

header {
  padding: 1rem 2rem;
  border-bottom: 1px solid var(--border);
}

.filter-bar {
  display: flex;
  justify-content: space-between;
  padding: 1rem 2rem;
  background: var(--card);
  border-bottom: 1px solid var(--border);
}

.filters select, .filters input {
  background: var(--bg);
  color: var(--fg);
  border: 1px solid var(--border);
  padding: 0.5rem;
  margin-right: 0.5rem;
  border-radius: 4px;
}

.view-toggle button {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--fg);
  padding: 0.5rem 1rem;
  cursor: pointer;
}

.view-toggle button.active {
  background: var(--accent);
  border-color: var(--accent);
}

.main-content {
  display: flex;
  flex: 1;
}

.board {
  display: flex;
  flex: 1;
  padding: 1rem;
  gap: 1rem;
  overflow-x: auto;
}

.board-column {
  min-width: 280px;
  background: var(--card);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.column-header {
  padding: 1rem;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.column-header h3 {
  font-size: 0.875rem;
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.count {
  background: var(--status-color, var(--muted));
  padding: 0.25rem 0.5rem;
  border-radius: 12px;
  font-size: 0.75rem;
}

.column-content {
  padding: 0.5rem;
  max-height: calc(100vh - 200px);
  overflow-y: auto;
}

.item-card {
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 0.75rem;
  margin-bottom: 0.5rem;
  cursor: pointer;
  transition: border-color 0.2s;
}

.item-card:hover {
  border-color: var(--accent);
}

.item-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 0.5rem;
}

.item-category {
  font-size: 0.625rem;
  padding: 0.125rem 0.375rem;
  border-radius: 3px;
  text-transform: uppercase;
}

.item-id {
  font-size: 0.75rem;
  color: var(--muted);
  font-family: monospace;
}

.item-name {
  font-size: 0.875rem;
  margin-bottom: 0.25rem;
}

.item-description {
  font-size: 0.75rem;
  color: var(--muted);
  margin-bottom: 0.5rem;
}

.item-thumb {
  width: 100%;
  border-radius: 4px;
  margin-bottom: 0.5rem;
}

.item-blocked {
  background: #e74c3c33;
  color: #e74c3c;
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.75rem;
  margin-bottom: 0.5rem;
}

.item-footer {
  border-top: 1px solid var(--border);
  padding-top: 0.5rem;
}

.source-link {
  font-size: 0.75rem;
  color: var(--accent);
  text-decoration: none;
}

.blocker-panel {
  width: 250px;
  background: var(--card);
  border-left: 1px solid var(--border);
  padding: 1rem;
}

.blocker-panel h3 {
  font-size: 0.875rem;
  margin-bottom: 1rem;
}

.blocker-list {
  list-style: none;
}

.blocker-item {
  padding: 0.5rem;
  background: #e74c3c22;
  border-radius: 4px;
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
}

.empty {
  color: var(--muted);
  font-size: 0.875rem;
}
```

**Acceptance**: UI looks clean and functional

---

### Task 12: Index HTML
**File**: `tracking-ui/index.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Production Tracking</title>
</head>
<body>
  <div id="app">Loading...</div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
```

**Acceptance**: HTML valid, loads main.ts

---

## Acceptance Criteria

### Must Have
- [ ] Kanban board with status columns
- [ ] Items displayed as cards with category, name, description
- [ ] Filter by status and category
- [ ] Search by name/id
- [ ] Blocker panel visible on side
- [ ] Link to source spec for each item
- [ ] All data in YAML files
- [ ] **Read-only by design** - AI handles writes

### Nice to Have
- [ ] Table view as alternative
- [ ] Dark/light theme toggle
- [ ] Item detail modal with full info

---

## Out of Scope (Explicit Design Decision)
- **CRUD UI** - No add/edit/delete forms. AI-mediated writes instead.
- **Drag-and-drop** - Not needed, AI updates status
- **Backend server** - Not needed, YAML files edited directly
- **Real-time updates** - Refresh page to see changes

---

## AI Commands Reference

The dashboard is read-only. Use Claude to make changes:

```
# Add items
"Add a new character CHAR-003 named 'Villain' with status planned"

# Update status
"Mark WARD-015 as complete"
"Move SHOT-012 to in_progress"

# Manage blockers
"Add blocker to PROP-003: waiting on concept approval"
"Remove blocker from CHAR-001"

# Add dependencies
"CHAR-001 depends on WARD-001 and PROP-015"

# Add images
"Add image .gsd-state/renders/CHAR-001-hero.png to CHAR-001"
```

---

## Future Phases
- Phase 12.0: 1-sheet generation
- Phase 12.1: Product shot integration

---

## Council of Ricks Review Notes

**Review Date**: 2026-02-19
**Status**: APPROVED with recommendations

### Critical Issues to Address (P0)

1. **Deployment Strategy Missing** (automation-rick)
   - How is the tracking UI served? Static files? Python server?
   - Add section documenting deployment strategy

2. **Build Integration Missing** (automation-rick)
   - Create `scripts/build_tracking_ui.sh` to orchestrate build
   - Document output location (`dist/` ‚Üí `.gsd-state/ui/`)

### High Priority (P1)

3. **YAML Schema Validation** (automation-rick)
   - Add runtime validation in `api.ts`
   - Consider using `zod` for type-safe validation
   - Show user-friendly errors for malformed YAML

4. **Error UX** (automation-rick)
   - `loadConfig()` silently falls back to defaults - add warning banner
   - `loadItems()` skips malformed files - aggregate and show summary
   - Document what user sees when errors occur

### Medium Priority (P2)

5. **Command Consistency** (pipeline-rick)
   - All Python animation phases should have "AI Commands Reference" section
   - Document both programmatic API and natural language commands

6. **Integration Documentation** (automation-rick)
   - Document TypeScript/Python hybrid architecture
   - Create `.planning/docs/UI_INTEGRATION.md`

### Testing Recommendations (dufus-rick)

7. **Add Test Tasks**
   - Task: Write unit tests for `api.ts` YAML loading
   - Task: Add E2E test for board rendering
   - Task: Test filter functionality

8. **Make Acceptance Criteria Testable**
   - "Kanban board renders" ‚Üí "Kanban board shows 5 status columns with items"
   - "Filters work" ‚Üí "Status filter shows only matching items"

---

## Commands

```bash
# Setup
cd tracking-ui
npm install

# Development
npm run dev

# Build for production
npm run build

# Preview production build
npm run preview
```

---

## Dependencies

```json
{
  "devDependencies": {
    "typescript": "^5.0.0",
    "vite": "^5.0.0",
    "@types/node": "^20.0.0",
    "@rollup/plugin-yaml": "^4.0.0"
  }
}
```
