# Phase 9.1: Set Builder

**Phase**: 9.1
**Priority**: P1
**Dependencies**: Phase 6.x (Core Cinematic)
**Est. Duration**: 5-6 days

---

## Goal

Implement procedural set construction system that builds environments from specifications.

---

## Requirements

- REQ-SET-01: Wall and room generation
- REQ-SET-02: Door and window placement
- REQ-SET-03: Prop population
- REQ-SET-04: Dressing styles
- REQ-SET-05: Period/style presets

---

## Plans

### Plan 9.1-01: Set Types

**Deliverable**: `lib/art/set_types.py`

```python
@dataclass
class WallConfig:
    """Wall configuration."""
    width: float = 4.0  # meters
    height: float = 2.8
    thickness: float = 0.15
    material: str = "drywall_white"
    baseboard_height: float = 0.1
    crown_molding: bool = False

@dataclass
class DoorConfig:
    """Door configuration."""
    width: float = 0.9
    height: float = 2.1
    style: str = "panel_6"  # panel_6, flush, barn, french
    material: str = "wood_oak"
    handle_style: str = "lever_modern"
    swing_direction: str = "in_left"

@dataclass
class WindowConfig:
    """Window configuration."""
    width: float = 1.2
    height: float = 1.4
    sill_height: float = 0.9
    style: str = "double_hung"  # double_hung, casement, picture, bay
    frame_material: str = "wood_white"
    has_curtains: bool = False
    curtain_style: str = "panel"

@dataclass
class RoomConfig:
    """Room configuration."""
    name: str
    width: float = 5.0
    depth: float = 4.0
    height: float = 2.8
    floor_material: str = "hardwood_oak"
    ceiling_material: str = "drywall_white"
    walls: Dict[str, WallConfig] = field(default_factory=dict)  # north, south, east, west
    doors: List[DoorPlacement] = field(default_factory=list)
    windows: List[WindowPlacement] = field(default_factory=list)

@dataclass
class SetConfig:
    """Complete set configuration."""
    name: str
    style: str = "modern_residential"  # modern_residential, victorian, industrial, office
    period: str = "present"  # present, 1920s, 1950s, 1980s, future
    rooms: List[RoomConfig] = field(default_factory=list)
    props: List[PropPlacement] = field(default_factory=list)
    lighting_type: str = "natural"  # natural, artificial, mixed
    time_of_day: str = "day"
```

**Tasks**:
1. Create all dataclasses
2. Add validation
3. Add style presets

---

### Plan 9.1-02: Room Builder

**Deliverable**: `lib/art/room_builder.py`

```python
def create_room(config: RoomConfig) -> Any:
    """Create room geometry."""
    pass

def create_floor(config: RoomConfig) -> Any:
    """Create floor mesh."""
    pass

def create_ceiling(config: RoomConfig) -> Any:
    """Create ceiling mesh."""
    pass

def create_wall(config: WallConfig, position: Tuple, rotation: float) -> Any:
    """Create wall mesh."""
    pass

def add_wall_opening(wall: Any, opening_type: str, position: Tuple, size: Tuple) -> Any:
    """Add door/window opening to wall."""
    pass

def create_molding(type: str, length: float) -> Any:
    """Create baseboard or crown molding."""
    pass
```

**Tasks**:
1. Implement floor/ceiling creation
2. Implement wall creation
3. Implement opening cutting
4. Implement molding
5. Test room assembly

---

### Plan 9.1-03: Door & Window Builder

**Deliverable**: `lib/art/openings.py`

```python
def create_door(config: DoorConfig) -> Any:
    """Create door mesh."""
    pass

def create_door_frame(config: DoorConfig) -> Any:
    """Create door frame."""
    pass

def create_window(config: WindowConfig) -> Any:
    """Create window mesh."""
    pass

def create_window_frame(config: WindowConfig) -> Any:
    """Create window frame."""
    pass

def create_curtains(config: WindowConfig) -> Any:
    """Create curtain geometry."""
    pass

def place_door(room: Any, wall: str, position: float, config: DoorConfig) -> Any:
    """Place door in room wall."""
    pass

def place_window(room: Any, wall: str, position: float, height: float, config: WindowConfig) -> Any:
    """Place window in room wall."""
    pass
```

**Tasks**:
1. Implement door styles
2. Implement window styles
3. Implement frame creation
4. Implement curtain creation
5. Test placement

---

### Plan 9.1-04: Prop System

**Deliverable**: `lib/art/props.py`

```python
@dataclass
class PropConfig:
    """Prop configuration."""
    name: str
    category: str  # furniture, decor, electronics, kitchen, bathroom
    style: str
    material: str
    scale: float = 1.0

@dataclass
class PropPlacement:
    """Prop placement in set."""
    prop: str  # Prop name or preset
    position: Tuple[float, float, float]
    rotation: Tuple[float, float, float]
    scale: float = 1.0
    variant: int = 0

def load_prop_library(path: str) -> Dict[str, PropConfig]:
    """Load prop library from directory."""
    pass

def place_prop(prop_name: str, position: Tuple, rotation: Tuple = (0,0,0)) -> Any:
    """Place prop in scene."""
    pass

def populate_room(room: Any, prop_list: List[PropPlacement]) -> Any:
    """Populate room with props."""
    pass

def apply_dressing_style(room: Any, style: str) -> List[PropPlacement]:
    """Auto-generate prop placements for dressing style."""
    pass

# Dressing styles
DRESSING_STYLES = {
    "minimal": {"prop_density": 0.3, "clutter": 0.1},
    "lived_in": {"prop_density": 0.7, "clutter": 0.5},
    "cluttered": {"prop_density": 0.9, "clutter": 0.8},
    "sterile": {"prop_density": 0.2, "clutter": 0.0},
}
```

**Tasks**:
1. Implement prop library loading
2. Implement prop placement
3. Implement room population
4. Implement dressing styles
5. Create prop presets

---

### Plan 9.1-05: Style Presets

**Deliverable**: `configs/art/set_presets.yaml`

```yaml
presets:
  modern_apartment:
    style: "modern_residential"
    period: "present"
    default_materials:
      floor: "hardwood_oak"
      walls: "drywall_white"
      ceiling: "drywall_white"
    default_props:
      - category: "furniture"
        style: "mid_century_modern"
      - category: "decor"
        style: "minimal"

  victorian_parlor:
    style: "victorian"
    period: "1890s"
    default_materials:
      floor: "hardwood_dark"
      walls: "wallpaper_floral"
      ceiling: "plaster_ornate"
    default_props:
      - category: "furniture"
        style: "victorian"
      - category: "decor"
        style: "antique"

  industrial_loft:
    style: "industrial"
    period: "present"
    default_materials:
      floor: "concrete_polished"
      walls: "brick_exposed"
      ceiling: "exposed_beam"
    default_props:
      - category: "furniture"
        style: "industrial"

  1980s_office:
    style: "corporate"
    period: "1980s"
    default_materials:
      floor: "carpet_beige"
      walls: "drywall_beige"
      ceiling: "acoustic_tile"
    default_props:
      - category: "furniture"
        style: "80s_office"
      - category: "electronics"
        style: "80s"
```

**Tasks**:
1. Create preset file
2. Implement preset loader
3. Create examples
4. Document presets

---

## Acceptance Criteria

- [ ] Rooms generate with correct dimensions
- [ ] Walls have proper openings
- [ ] Doors and windows place correctly
- [ ] Props populate rooms
- [ ] Dressing styles affect density
- [ ] Presets load correctly

---

## Files

```
lib/art/
├── __init__.py
├── set_types.py          # Data structures
├── room_builder.py       # Room construction
├── openings.py           # Doors and windows
└── props.py              # Prop system

configs/art/
├── set_presets.yaml      # Style presets
├── props/
│   ├── furniture.yaml
│   ├── decor.yaml
│   └── electronics.yaml
└── materials/
    └── set_materials.yaml
```
