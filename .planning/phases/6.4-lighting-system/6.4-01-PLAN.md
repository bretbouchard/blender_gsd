# Phase 6.4: Lighting System

**Phase**: 6.4
**Priority**: P0
**Dependencies**: Phase 6.0 (Foundation)
**Est. Duration**: 4-5 days

---

## Goal

Implement modular lighting system with presets, rigs, gels, and HDRI support.

---

## Requirements

- REQ-CINE-LIGHT-01: Light creation and configuration
- REQ-CINE-LIGHT-02: Lighting rig presets
- REQ-CINE-LIGHT-03: Gel system
- REQ-CINE-LIGHT-04: HDRI environment lighting
- REQ-CINE-LIGHT-05: Light linking

---

## Plans

### Plan 6.4-01: Light Types (Already in types.py)

Types already defined:
- LightConfig
- GelConfig
- HDRIConfig
- LightRigConfig

**Task**: Verify types work with Blender

---

### Plan 6.4-02: Light Creator

**Deliverable**: `lib/cinematic/lighting.py`

```python
def create_light(config: LightConfig) -> Any:
    """Create light from configuration."""
    pass

def configure_area_light(light: Any, config: LightConfig) -> None:
    """Configure area light specific properties."""
    pass

def configure_spot_light(light: Any, config: LightConfig) -> None:
    """Configure spot light specific properties."""
    pass

def configure_point_light(light: Any, config: LightConfig) -> None:
    """Configure point light properties."""
    pass

def configure_sun_light(light: Any, config: LightConfig) -> None:
    """Configure sun light properties."""
    pass

def delete_light(name: str) -> None:
    """Delete light by name."""
    pass

def list_lights() -> List[str]:
    """List all lights in scene."""
    pass
```

**Tasks**:
1. Implement light creation
2. Implement type-specific configuration
3. Implement deletion and listing

---

### Plan 6.4-03: Light Rigs

**Deliverable**: `lib/cinematic/light_rigs.py`

```python
def create_light_rig(config: LightRigConfig, subject_position: Tuple) -> List[Any]:
    """Create complete lighting rig from preset."""
    pass

def create_three_point_soft(subject_position: Tuple) -> List[LightConfig]:
    """Create soft three-point lighting."""
    pass

def create_three_point_hard(subject_position: Tuple) -> List[LightConfig]:
    """Create hard three-point lighting."""
    pass

def create_product_hero(subject_position: Tuple) -> List[LightConfig]:
    """Create product hero lighting."""
    pass

def create_studio_high_key(subject_position: Tuple) -> List[LightConfig]:
    """Create high-key studio lighting."""
    pass

def create_studio_low_key(subject_position: Tuple) -> List[LightConfig]:
    """Create low-key studio lighting."""
    pass

def position_key_light(config: LightConfig, subject_position: Tuple, angle: float, elevation: float) -> LightConfig:
    """Position key light relative to subject."""
    pass

def position_fill_light(config: LightConfig, key_config: LightConfig, ratio: float) -> LightConfig:
    """Position fill light based on key and ratio."""
    pass

def position_back_light(config: LightConfig, subject_position: Tuple, elevation: float) -> LightConfig:
    """Position back/rim light."""
    pass
```

**Tasks**:
1. Implement rig creation
2. Implement individual rig presets
3. Implement positioning helpers

---

### Plan 6.4-04: Gel System

**Deliverable**: `lib/cinematic/gels.py`

```python
def apply_gel(light: Any, config: GelConfig) -> None:
    """Apply gel to light."""
    pass

def get_gel_preset(name: str) -> GelConfig:
    """Get gel preset by name."""
    pass

def create_cto_gel(intensity: str = "full") -> GelConfig:
    """Create Color Temperature Orange gel."""
    pass

def create_ctb_gel(intensity: str = "full") -> GelConfig:
    """Create Color Temperature Blue gel."""
    pass

def create_diffusion_gel(strength: str = "half") -> GelConfig:
    """Create diffusion gel."""
    pass

def combine_gels(gels: List[GelConfig]) -> GelConfig:
    """Combine multiple gels."""
    pass
```

**Tasks**:
1. Implement gel application
2. Implement presets
3. Implement combination

---

### Plan 6.4-05: HDRI System

**Deliverable**: `lib/cinematic/hdri.py`

```python
def load_hdri(config: HDRIConfig) -> Any:
    """Load HDRI environment."""
    pass

def find_hdri_path(preset_name: str) -> str:
    """Find HDRI file in search paths."""
    pass

def configure_hdri_world(config: HDRIConfig) -> Any:
    """Configure world shader for HDRI."""
    pass

def rotate_hdri(rotation: float) -> None:
    """Rotate HDRI environment."""
    pass

def set_hdri_exposure(exposure: float) -> None:
    """Set HDRI exposure."""
    pass

def list_hdri_presets() -> List[str]:
    """List available HDRI presets."""
    pass
```

**Tasks**:
1. Implement HDRI loading
2. Implement path finding
3. Implement configuration

---

### Plan 6.4-06: Light Linking

**Deliverable**: `lib/cinematic/light_linking.py`

```python
def link_light_to_collection(light: Any, collection: Any) -> None:
    """Link light to only affect specific collection."""
    pass

def unlink_light_from_collection(light: Any, collection: Any) -> None:
    """Remove light link from collection."""
    pass

def set_light_include_only(light: Any, objects: List[str]) -> None:
    """Set light to only affect specified objects."""
    pass

def set_light_exclude(light: Any, objects: List[str]) -> None:
    """Set light to exclude specified objects."""
    pass

def get_light_links(light: Any) -> Dict:
    """Get light linking configuration."""
    pass
```

**Tasks**:
1. Implement light linking
2. Implement include/exclude
3. Implement query

---

### Plan 6.4-07: Presets

**Deliverable**: `configs/cinematic/lighting/rig_presets.yaml`

```yaml
presets:
  three_point_soft:
    description: "Classic soft three-point lighting"
    lights:
      key:
        light_type: "area"
        shape: "RECTANGLE"
        size: 2.0
        intensity: 1000
      fill:
        light_type: "area"
        shape: "RECTANGLE"
        size: 3.0
        intensity: 400
      back:
        light_type: "area"
        shape: "RECTANGLE"
        size: 1.5
        intensity: 600

  product_hero:
    description: "Dramatic product lighting"
    lights:
      key:
        light_type: "area"
        intensity: 1500
      fill:
        light_type: "area"
        intensity: 300
      rim:
        light_type: "area"
        intensity: 800
      top:
        light_type: "area"
        intensity: 400
```

**Tasks**:
1. Create preset file
2. Implement loader
3. Create examples

---

## Acceptance Criteria

- [ ] All light types created correctly
- [ ] Rigs position lights appropriately
- [ ] Gels modify light color
- [ ] HDRI loads and configures
- [ ] Light linking works
- [ ] Presets load correctly

---

## Files

```
lib/cinematic/
├── lighting.py          # Light creation
├── light_rigs.py        # Rig presets
├── gels.py              # Gel system
├── hdri.py              # HDRI system
└── light_linking.py     # Light linking

configs/cinematic/lighting/
├── rig_presets.yaml
├── gel_presets.yaml
└── hdri_presets.yaml
```
