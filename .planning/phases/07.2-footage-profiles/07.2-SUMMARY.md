# Phase 7.2: Footage Profiles Summary

**Completed:** 2026-02-20
**Commit:** fd4485e

## Overview

Implemented comprehensive footage metadata extraction and content analysis system for motion tracking workflows. This phase provides automatic device detection, content quality analysis, and tracking recommendations based on footage properties.

## Files Created

| File | Description |
|------|-------------|
| `lib/cinematic/tracking/footage_profiles.py` | Main footage profiles module |
| `configs/cinematic/tracking/footage_profiles.yaml` | Configuration for rolling shutter profiles, quality thresholds |
| `tests/unit/test_tracking_footage_profiles.py` | Unit tests (37 tests) |

## Files Modified

| File | Changes |
|------|---------|
| `lib/cinematic/tracking/types.py` | Extended FootageMetadata, added RollingShutterConfig |
| `lib/cinematic/tracking/__init__.py` | Added exports for footage profile components |

## Components Implemented

### 1. Extended FootageMetadata (Plan 07.2-01)

Extended the FootageMetadata dataclass with:
- **Video properties:** width, height, fps, frame_count, codec, codec_profile, bit_depth
- **Color info:** color_space, color_range, pixel_aspect_ratio
- **Device metadata:** camera_make, camera_model, lens_model, focal_length_mm, iso, aperture, white_balance
- **Content analysis:** motion_blur_level, noise_level, contrast_suitability, dominant_motion
- **Backward compatibility:** Properties for old field names (resolution, duration_frames, etc.)

### 2. RollingShutterConfig (Plan 07.2-01)

Dataclass for rolling shutter detection/compensation:
- `detected`: Whether rolling shutter was detected
- `severity`: "none", "low", "medium", "high"
- `read_time`: Sensor read time in seconds
- `skew_angle`: Detected skew angle in degrees
- `method`: "row_rolling" or "global_shutter"
- `compensation_enabled`: Whether to apply compensation

### 3. FFprobeMetadataExtractor (Plan 07.2-01)

Comprehensive metadata extraction using ffprobe:
- Video stream info (resolution, fps, codec, bit depth)
- Format info (duration)
- Device metadata from QuickTime/MP4 tags
- Frame rate parsing (rational: 30000/1001 = 29.97fps)

### 4. FootageAnalyzer (Plan 07.2-01)

Content quality analysis:
- Motion blur inference from fps
- Noise level inference from ISO
- Contrast suitability inference from resolution

### 5. RollingShutterDetector (Plan 07.2-01)

Device-specific rolling shutter detection:
- Pattern matching for 30+ device models
- Read time lookup table (phones: 10-25ms, cinema: 3-5ms)
- Severity classification based on thresholds

### 6. ImageSequenceAnalyzer (Plan 07.2-03)

Support for image sequences:
- Format support: EXR, DPX, TIFF, PNG, JPEG, TGA
- Sequence pattern parsing (####, %04d)
- Frame detection and missing frame detection
- Header parsing for dimensions (PNG, EXR, DPX, JPEG)

### 7. FootageProfile (Plan 07.2-01)

Unified profile combining:
- FootageMetadata
- ContentAnalysis
- RollingShutterConfig
- Tracking recommendations

### 8. Configuration File (Plan 07.2-02)

`footage_profiles.yaml` contains:
- Rolling shutter read times by device
- Severity thresholds (none: <3ms, low: <8ms, medium: <15ms, high: >=15ms)
- Content quality thresholds
- Tracking recommendations by content type
- Device detection patterns
- QuickTime tag mappings

## Test Results

```
tests/unit/test_tracking_footage_profiles.py
37 passed in 0.78s
```

Test coverage includes:
- FootageMetadata: 7 tests
- RollingShutterConfig: 3 tests
- ContentAnalysis: 2 tests
- FFprobeMetadataExtractor: 5 tests
- RollingShutterDetector: 4 tests
- ImageSequenceAnalyzer: 3 tests
- FootageProfile: 5 tests
- Convenience functions: 4 tests
- FootageAnalyzer: 3 tests

## Requirements Satisfied

| Requirement | Description | Status |
|-------------|-------------|--------|
| REQ-CINE-MATCH | Camera Matching & Calibration | Partial |
| REQ-TRACK-SOLVE | Camera Solve Workflow | Supported |

## API Reference

```python
from lib.cinematic.tracking import (
    # Types
    FootageMetadata,
    RollingShutterConfig,
    ContentAnalysis,

    # Classes
    FFprobeMetadataExtractor,
    FootageAnalyzer,
    RollingShutterDetector,
    FootageProfile,
    ImageSequenceAnalyzer,

    # Functions
    extract_metadata,
    analyze_footage,
    analyze_image_sequence,
    get_tracking_recommendations,
)

# Analyze video file
profile = analyze_footage("/path/to/video.mp4")
print(profile.metadata.camera_model)
print(profile.rolling_shutter.severity)

# Get tracking recommendations
rec = profile.get_tracking_recommendations()
print(rec["preset"])  # "balanced", "precise", "fast"
print(rec["notes"])   # List of recommendations

# Analyze image sequence
profile = analyze_image_sequence("/path/to/frame_####.exr", fps=24.0)
```

## Dependencies

- ffprobe (part of ffmpeg) for video metadata extraction
- No additional Python dependencies

## Next Steps

Phase 7.3 (Camera Solving) can leverage footage profiles for:
- Auto-selecting tracking preset based on content quality
- Configuring rolling shutter compensation
- Setting appropriate correlation thresholds for noise levels
