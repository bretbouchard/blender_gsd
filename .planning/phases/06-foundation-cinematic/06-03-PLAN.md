---
phase: 06-foundation-cinematic
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - .gsd-state/cinematic/camera/.gitkeep
  - .gsd-state/cinematic/lighting/.gitkeep
  - .gsd-state/cinematic/frames/frame_index.yaml
  - .gsd-state/cinematic/sessions/.gitkeep
autonomous: true

must_haves:
  truths:
    - "State directories exist for camera, lighting, frames, and sessions"
    - "Frame index file is valid YAML"
    - "State manager can write to all directories"
  artifacts:
    - path: ".gsd-state/cinematic/frames/frame_index.yaml"
      provides: "Master index for frame versions"
      contains: "version:"
    - path: ".gsd-state/cinematic/camera/"
      provides: "Camera state storage"
    - path: ".gsd-state/cinematic/sessions/"
      provides: "Session resume state storage"
  key_links:
    - from: ".gsd-state/cinematic/"
      to: "lib/cinematic/state_manager.py"
      via: "State persistence"
      pattern: "StateManager writes to .gsd-state/cinematic/"
---

<objective>
Create the state persistence directory structure for the cinematic system.

Purpose: Establish the `.gsd-state/cinematic/` directory where all runtime state will be persisted. This includes camera transforms, lighting configurations, frame versions for A/B comparison, and session state for resumable workflows. The state directory is separate from configuration presets - it stores runtime/working state.

Output: 4 state subdirectories with initial files (.gitkeep and frame_index.yaml).
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@/Users/bretbouchard/apps/blender_gsd/.planning/ROADMAP.md
@/Users/bretbouchard/apps/blender_gsd/.planning/phases/06-foundation-cinematic/06-RESEARCH.md
@/Users/bretbouchard/apps/blender_gsd/.planning/design/CINEMATIC_SYSTEM_DESIGN.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create state directory structure</name>
  <files>
    - .gsd-state/cinematic/camera/.gitkeep
    - .gsd-state/cinematic/lighting/.gitkeep
    - .gsd-state/cinematic/frames/frame_index.yaml
    - .gsd-state/cinematic/sessions/.gitkeep
  </files>
  <action>
Create the `.gsd-state/cinematic/` directory with 4 subdirectories.

**Directory structure:**
```
.gsd-state/
└── cinematic/
    ├── camera/
    │   └── .gitkeep
    ├── lighting/
    │   └── .gitkeep
    ├── frames/
    │   └── frame_index.yaml
    └── sessions/
        └── .gitkeep
```

**Purpose of each directory:**

1. **camera/** - Stores per-shot camera state (transform, settings)
   - Files: `{shot_name}.yaml`
   - Used by: StateManager.capture_current(), StateManager.restore()

2. **lighting/** - Stores per-shot lighting state (positions, intensities)
   - Files: `{shot_name}.yaml`
   - Used by: StateManager for lighting persistence

3. **frames/** - Stores versioned frames for A/B comparison
   - Subdirectories: `{shot_name}/001/`, `{shot_name}/002/`, etc.
   - Each frame contains: `state.yaml`, optionally `thumbnail.png`
   - Master index: `frame_index.yaml`

4. **sessions/** - Stores session state for resumable workflows
   - Files: `{session_id}.yaml`
   - Used by: Resume/edit workflow

**frame_index.yaml content:**
```yaml
# Frame Store Index
# Tracks all saved frames for A/B comparison workflow
#
# Structure:
# shots:
#   shot_name:
#     frames: [1, 2, 3, ...]
#     current: 3

version: 1
shots: {}
```

**Implementation:**
```bash
# Create all directories
mkdir -p .gsd-state/cinematic/camera
mkdir -p .gsd-state/cinematic/lighting
mkdir -p .gsd-state/cinematic/frames
mkdir -p .gsd-state/cinematic/sessions

# Create .gitkeep files for empty directories
touch .gsd-state/cinematic/camera/.gitkeep
touch .gsd-state/cinematic/lighting/.gitkeep
touch .gsd-state/cinematic/sessions/.gitkeep

# Create frame index
cat > .gsd-state/cinematic/frames/frame_index.yaml << 'EOF'
# Frame Store Index
# Tracks all saved frames for A/B comparison workflow
#
# Structure:
# shots:
#   shot_name:
#     frames: [1, 2, 3, ...]
#     current: 3

version: 1
shots: {}
EOF
```

CRITICAL:
- Use `.gitkeep` files to ensure empty directories are tracked by git
- The `frame_index.yaml` must be valid YAML with `version: 1` and `shots: {}`
  </action>
  <verify>
```bash
# Verify all directories exist
test -d .gsd-state/cinematic/camera && echo "camera/ OK"
test -d .gsd-state/cinematic/lighting && echo "lighting/ OK"
test -d .gsd-state/cinematic/frames && echo "frames/ OK"
test -d .gsd-state/cinematic/sessions && echo "sessions/ OK"

# Verify .gitkeep files exist
test -f .gsd-state/cinematic/camera/.gitkeep && echo "camera/.gitkeep OK"
test -f .gsd-state/cinematic/lighting/.gitkeep && echo "lighting/.gitkeep OK"
test -f .gsd-state/cinematic/sessions/.gitkeep && echo "sessions/.gitkeep OK"

# Verify frame_index.yaml is valid YAML
python3 -c "
import yaml
data = yaml.safe_load(open('.gsd-state/cinematic/frames/frame_index.yaml'))
assert data['version'] == 1, 'Frame index must have version: 1'
assert data['shots'] == {}, 'Frame index must start with empty shots dict'
print('frame_index.yaml validated')
print(f'  version: {data[\"version\"]}')
print(f'  shots: {data[\"shots\"]}')
"
```
  </verify>
  <done>All 4 state directories exist with .gitkeep files, frame_index.yaml is valid YAML</done>
</task>

</tasks>

<verification>
Verify the complete state directory structure:

```bash
echo "State Directory Structure:"
echo ""

# Show directory tree
find .gsd-state/cinematic -type f -o -type d | sort | while read item; do
  if [ -d "$item" ]; then
    echo "DIR:  $item/"
  else
    echo "FILE: $item"
  fi
done

echo ""
echo "Content of frame_index.yaml:"
cat .gsd-state/cinematic/frames/frame_index.yaml
```
</verification>

<success_criteria>
- .gsd-state/cinematic/ directory exists
- camera/ subdirectory exists with .gitkeep
- lighting/ subdirectory exists with .gitkeep
- frames/ subdirectory exists with frame_index.yaml
- sessions/ subdirectory exists with .gitkeep
- frame_index.yaml contains valid YAML with version: 1 and shots: {}
</success_criteria>

<output>
After completion, create `.planning/phases/06-foundation-cinematic/06-03-SUMMARY.md`
</output>
