---
phase: 07.1-core-tracking
plan: 04
type: execute
wave: 4
depends_on: ["07.1-03"]
files_modified:
  - lib/cinematic/tracking/__init__.py
  - lib/cinematic/__init__.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All tracking exports accessible from lib.cinematic.tracking"
    - "Tracking exports visible from main cinematic package"
    - "Version updated to 0.3.2"
    - "Complete tracking workflow available (detect -> track -> solve -> camera)"
  artifacts:
    - path: "lib/cinematic/tracking/__init__.py"
      provides: "Complete tracking package exports"
      min_lines: 80
      contains: "__all__"
    - path: "lib/cinematic/__init__.py"
      provides: "Cinematic package with tracking integration"
      contains: "from .tracking import"
  key_links:
    - from: "lib/cinematic/__init__.py"
      to: "lib/cinematic/tracking/"
      via: "package imports"
      pattern: "from .tracking"
---

<objective>
Update package exports and version to complete Phase 7.1 integration.

Purpose: Make all tracking functionality accessible from both lib.cinematic.tracking and lib.cinematic, update version to 0.3.2.
Output: Updated __init__.py files with complete tracking exports, version 0.3.2.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

# Reference existing tracking modules
@lib/cinematic/tracking/types.py
@lib/cinematic/tracking/context.py
@lib/cinematic/tracking/presets.py
@lib/cinematic/tracking/point_tracker.py
@lib/cinematic/tracking/quality.py
@lib/cinematic/tracking/camera_solver.py
@lib/cinematic/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Update tracking package exports</name>
  <files>lib/cinematic/tracking/__init__.py</files>
  <action>
Update the tracking package __init__.py to export all Phase 7.1 modules.

If the file exists from Phase 7.0, extend it with new exports. If not, create complete file.

Required exports structure:
```python
"""
Motion Tracking Package

Provides types and utilities for motion tracking workflows:
- TrackData, SolveData, FootageMetadata, TrackingSession, SolveReport types
- Footage metadata extraction via ffprobe
- External tracking import (Nuke .chan, coordinate conversion)
- Context management for Blender tracking operators
- Point tracking with feature detection and KLT optical flow
- Track quality analysis and filtering
- Camera solving with libmv integration
- State persistence for resume capability

Quick Start:
    from lib.cinematic.tracking import (
        TrackData, SolveData, FootageMetadata, TrackingSession,
        extract_metadata, analyze_footage,
        tracking_context, ensure_clip_loaded,
        detect_features, track_markers, PointTracker,
        analyze_track_quality, clean_low_quality_tracks,
        solve_camera, create_camera_from_solve, CameraSolver,
    )

    # Load footage
    clip = ensure_clip_loaded("footage/shot.mp4")

    # Detect and track features
    with tracking_context(clip) as ctx:
        detect_features(clip, preset="balanced")
        track_markers(clip)

    # Clean low-quality tracks
    clean_low_quality_tracks(clip, frames=5, error=2.0)

    # Solve camera
    solver = CameraSolver(clip)
    result = solver.solve(refine_focal_length=True)

    if result['success']:
        camera = solver.create_camera("Tracked Camera")
        print(f"Average error: {solver.average_error:.2f}px")
"""

try:
    import bpy
    BLENDER_AVAILABLE = True
except ImportError:
    bpy = None
    BLENDER_AVAILABLE = False

# Phase 7.0: Types
from .types import (
    TrackData,
    SolveData,
    SolveReport,
    FootageMetadata,
    TrackingSession,
)

# Phase 7.0: Footage
from .footage import (
    extract_metadata,
    analyze_footage,
    get_frame_rate,
)

# Phase 7.0: Import/Export
from .import_export import (
    convert_yup_to_zup_position,
    convert_yup_to_zup_rotation,
    fov_to_focal_length,
    import_nuke_chan,
    import_tracking_data,
)

# Phase 7.0: Session Management
from .session_manager import (
    TrackingSessionManager,
)

# Phase 7.1: Context Management
from .context import (
    tracking_context,
    get_clip_editor_area,
    ensure_clip_loaded,
    get_active_clip,
)

# Phase 7.1: Presets
from .presets import (
    load_tracking_preset,
    get_tracking_preset,
    get_detection_params,
    get_tracking_params,
    list_tracking_presets,
)

# Phase 7.1: Point Tracking (REQ-TRACK-POINT)
from .point_tracker import (
    detect_features,
    track_markers,
    add_track,
    delete_track,
    configure_track,
    PointTracker,
)

# Phase 7.1: Track Quality
from .quality import (
    analyze_track_quality,
    clean_low_quality_tracks,
    filter_tracks_by_correlation,
    get_track_quality_report,
)

# Phase 7.1: Camera Solver (REQ-TRACK-SOLVE)
from .camera_solver import (
    solve_camera,
    create_camera_from_solve,
    apply_camera_from_solve,
    get_solve_report,
    export_solve_data,
    CameraSolver,
)

__all__ = [
    # Types
    "TrackData",
    "SolveData",
    "SolveReport",
    "FootageMetadata",
    "TrackingSession",
    # Footage
    "extract_metadata",
    "analyze_footage",
    "get_frame_rate",
    # Import/Export
    "convert_yup_to_zup_position",
    "convert_yup_to_zup_rotation",
    "fov_to_focal_length",
    "import_nuke_chan",
    "import_tracking_data",
    # Session Management
    "TrackingSessionManager",
    # Context Management
    "tracking_context",
    "get_clip_editor_area",
    "ensure_clip_loaded",
    "get_active_clip",
    # Presets
    "load_tracking_preset",
    "get_tracking_preset",
    "get_detection_params",
    "get_tracking_params",
    "list_tracking_presets",
    # Point Tracking (REQ-TRACK-POINT)
    "detect_features",
    "track_markers",
    "add_track",
    "delete_track",
    "configure_track",
    "PointTracker",
    # Track Quality
    "analyze_track_quality",
    "clean_low_quality_tracks",
    "filter_tracks_by_correlation",
    "get_track_quality_report",
    # Camera Solver (REQ-TRACK-SOLVE)
    "solve_camera",
    "create_camera_from_solve",
    "apply_camera_from_solve",
    "get_solve_report",
    "export_solve_data",
    "CameraSolver",
    # Constants
    "BLENDER_AVAILABLE",
]

__version__ = "0.2.0"
```

Update version from 0.1.0 to 0.2.0 to reflect Phase 7.1 completion.
</action>
  <verify>
python3 -c "
from lib.cinematic.tracking import (
    # Types
    TrackData, SolveData, FootageMetadata, TrackingSession, SolveReport,
    # Context
    tracking_context, ensure_clip_loaded,
    # Presets
    get_tracking_preset, list_tracking_presets,
    # Point Tracking
    detect_features, track_markers, add_track, delete_track, PointTracker,
    # Quality
    analyze_track_quality, clean_low_quality_tracks,
    # Camera Solver
    solve_camera, create_camera_from_solve, CameraSolver,
    # Constants
    BLENDER_AVAILABLE, __version__,
)

print(f'Tracking package version: {__version__}')
print(f'BLENDER_AVAILABLE: {BLENDER_AVAILABLE}')
print('All tracking exports accessible')
"
  </verify>
  <done>
- lib/cinematic/tracking/__init__.py exports all Phase 7.1 modules
- Version updated to 0.2.0
- All REQ-TRACK-POINT and REQ-TRACK-SOLVE functions exported
  </done>
</task>

<task type="auto">
  <name>Update cinematic package exports</name>
  <files>lib/cinematic/__init__.py</files>
  <action>
Update the main cinematic package __init__.py to include all Phase 7.1 tracking exports.

Add to the existing file (DO NOT rewrite entire file):

1. Add Phase 7.1 tracking imports after Phase 7.0 section:
```python
# Tracking System - Phase 7.1 (REQ-TRACK-POINT, REQ-TRACK-SOLVE)
from .tracking.context import (
    tracking_context, get_clip_editor_area, ensure_clip_loaded, get_active_clip
)
from .tracking.presets import (
    load_tracking_preset, get_tracking_preset, get_detection_params,
    get_tracking_params, list_tracking_presets
)
from .tracking.point_tracker import (
    detect_features, track_markers, add_track, delete_track,
    configure_track, PointTracker
)
from .tracking.quality import (
    analyze_track_quality, clean_low_quality_tracks,
    filter_tracks_by_correlation, get_track_quality_report
)
from .tracking.camera_solver import (
    solve_camera, create_camera_from_solve, apply_camera_from_solve,
    get_solve_report, export_solve_data, CameraSolver
)
```

2. Add to __all__ list (in tracking section):
```python
    # Tracking System - Phase 7.1
    "tracking_context",
    "get_clip_editor_area",
    "ensure_clip_loaded",
    "get_active_clip",
    "load_tracking_preset",
    "get_tracking_preset",
    "get_detection_params",
    "get_tracking_params",
    "list_tracking_presets",
    "detect_features",
    "track_markers",
    "add_track",
    "delete_track",
    "configure_track",
    "PointTracker",
    "analyze_track_quality",
    "clean_low_quality_tracks",
    "filter_tracks_by_correlation",
    "get_track_quality_report",
    "solve_camera",
    "create_camera_from_solve",
    "apply_camera_from_solve",
    "get_solve_report",
    "export_solve_data",
    "CameraSolver",
```

3. Update version from "0.3.1" to "0.3.2"

4. Update module docstring to include Phase 7.1 features:
   - tracking context management
   - point tracking with feature detection
   - track quality analysis
   - camera solving
</action>
  <verify>
python3 -c "
from lib.cinematic import (
    # Phase 7.1 Tracking
    tracking_context, ensure_clip_loaded,
    get_tracking_preset, list_tracking_presets,
    detect_features, track_markers, PointTracker,
    analyze_track_quality, clean_low_quality_tracks,
    solve_camera, create_camera_from_solve, CameraSolver,
    __version__,
)

print(f'Cinematic package version: {__version__}')
assert __version__ == '0.3.2', f'Version should be 0.3.2, got {__version__}'
print('All Phase 7.1 exports accessible from lib.cinematic')
"
  </verify>
  <done>
- lib/cinematic/__init__.py includes Phase 7.1 tracking exports
- Version updated to 0.3.2
- All tracking functions accessible from main cinematic package
- Module docstring updated
  </done>
</task>

</tasks>

<verification>
# Phase-level verification
1. All Phase 7.1 exports accessible from lib.cinematic.tracking
2. All Phase 7.1 exports accessible from lib.cinematic
3. Version is 0.3.2
4. No import errors or circular dependencies
5. Complete tracking workflow (detect -> track -> clean -> solve -> camera) available
</verification>

<success_criteria>
- lib/cinematic/tracking/__init__.py has complete exports
- lib/cinematic/__init__.py includes Phase 7.1 exports
- Version is 0.3.2
- REQ-TRACK-POINT complete (feature detection, tracking, management)
- REQ-TRACK-SOLVE complete (libmv integration, camera creation)
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-core-tracking/07.1-04-SUMMARY.md`
</output>
