---
phase: 07.0-tracking-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - configs/cinematic/tracking/tracking_presets.yaml
  - configs/cinematic/tracking/solver_settings.yaml
  - configs/cinematic/tracking/import_formats.yaml
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Tracking presets define quality/speed tradeoffs"
    - "Solver settings configure libmv parameters"
    - "Import formats document external tracking support"
    - "Presets are loadable via existing preset_loader patterns"
  artifacts:
    - path: "configs/cinematic/tracking/tracking_presets.yaml"
      provides: "Tracking quality presets"
      min_lines: 60
    - path: "configs/cinematic/tracking/solver_settings.yaml"
      provides: "Camera solver configurations"
      min_lines: 40
    - path: "configs/cinematic/tracking/import_formats.yaml"
      provides: "External format mappings"
      min_lines: 50
  key_links:
    - from: "configs/cinematic/tracking/"
      to: "lib/cinematic/preset_loader.py"
      via: "YAML preset loading"
      pattern: "load_preset"
---

<objective>
Create tracking configuration presets and settings.

Purpose: Establish YAML configuration files for tracking quality presets, solver settings, and import format mappings.
Output: tracking_presets.yaml, solver_settings.yaml, import_formats.yaml in configs/cinematic/tracking/
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07.0-tracking-foundation/07.0-RESEARCH.md
@.planning/REQUIREMENTS_TRACKING.md

# Reference existing config patterns
@configs/cinematic/tracking/camera_profiles.yaml
</context>

<tasks>

<task type="auto">
  <name>Create tracking_presets.yaml</name>
  <files>configs/cinematic/tracking/tracking_presets.yaml</files>
  <action>
Create tracking quality presets following the requirements and research patterns.

Based on REQ-TRACK-POINT, create presets:

presets:
  # High-quality tracking (slower)
  high_quality:
    description: "High-quality tracking for production work"
    detection:
      method: harris
      min_corners: 200
      quality_level: 0.02
      min_distance: 10
    algorithm:
      window_size: 31
      max_levels: 5
    track_management:
      drop_threshold:
        correlation: 0.8
        error: 3.0

  # Balanced (default)
  balanced:
    description: "Balanced tracking for general use"
    detection:
      method: fast
      min_corners: 100
      quality_level: 0.01
      min_distance: 10
    algorithm:
      window_size: 21
      max_levels: 3
    track_management:
      drop_threshold:
        correlation: 0.7
        error: 5.0

  # Fast tracking (lower quality)
  fast:
    description: "Fast tracking for preview"
    detection:
      method: fast
      min_corners: 50
      quality_level: 0.005
      min_distance: 8
    algorithm:
      window_size: 15
      max_levels: 2
    track_management:
      drop_threshold:
        correlation: 0.6
        error: 8.0

  # Architectural (for buildings/interiors)
  architectural:
    description: "Optimized for architectural footage"
    detection:
      method: harris
      min_corners: 150
      quality_level: 0.015
      min_distance: 12
    algorithm:
      window_size: 25
      max_levels: 4
    constraints:
      prefer_lines: true
      prefer_corners: true
  </action>
  <verify>
cat configs/cinematic/tracking/tracking_presets.yaml | head -20
python3 -c "
import yaml
with open('configs/cinematic/tracking/tracking_presets.yaml') as f:
    data = yaml.safe_load(f)
assert 'presets' in data
assert 'balanced' in data['presets']
assert 'high_quality' in data['presets']
print('tracking_presets.yaml is valid YAML with expected structure')
"
  </verify>
  <done>
- tracking_presets.yaml exists with 4 presets
- YAML is valid and parseable
- Each preset has detection, algorithm, track_management sections
  </done>
</task>

<task type="auto">
  <name>Create solver_settings.yaml</name>
  <files>configs/cinematic/tracking/solver_settings.yaml</files>
  <action>
Create camera solver configuration settings for Blender's libmv integration.

Based on REQ-TRACK-SOLVE:

settings:
  # Default solver settings
  default:
    description: "Standard camera solve settings"
    refinement:
      refine_focal_length: true
      refine_principal_point: false
      refine_radial_distortion: "k1_only"  # k1_only, k1_k2, none
    motion:
      type: "perspective"  # perspective, affine
    keyframes:
      auto_select: true
      min_keyframes: 8
      method: "motion_analysis"  # Select frames with good parallax
    quality:
      max_reprojection_error: 1.0  # Pixels
      min_tracks_per_frame: 8
      acceptable_error: 0.5

  # Fixed focal length (no zoom)
  fixed_focal:
    description: "Fixed focal length, no zoom"
    refinement:
      refine_focal_length: false
      refine_principal_point: false
      refine_radial_distortion: "k1_only"
    motion:
      type: "perspective"

  # Zoom lens
  zoom_lens:
    description: "Allow focal length variation for zoom lenses"
    refinement:
      refine_focal_length: true
      refine_principal_point: false
      refine_radial_distortion: "k1_k2"
    motion:
      type: "perspective"
    focal_length:
      constraints:
        min: 20.0
        max: 100.0

  # Architectural solve
  architectural:
    description: "Optimized for architectural scenes"
    refinement:
      refine_focal_length: true
      refine_principal_point: false
      refine_radial_distortion: "k1_only"
    motion:
      type: "perspective"
    constraints:
      prefer_vertical_lines: true
      prefer_horizontal_lines: true
  </action>
  <verify>
python3 -c "
import yaml
with open('configs/cinematic/tracking/solver_settings.yaml') as f:
    data = yaml.safe_load(f)
assert 'settings' in data
assert 'default' in data['settings']
assert data['settings']['default']['refinement']['refine_focal_length'] == True
print('solver_settings.yaml is valid YAML with expected structure')
"
  </verify>
  <done>
- solver_settings.yaml exists with 4 settings profiles
- YAML is valid and parseable
- Each profile has refinement, motion, keyframes sections
  </done>
</task>

<task type="auto">
  <name>Create import_formats.yaml</name>
  <files>configs/cinematic/tracking/import_formats.yaml</files>
  <action>
Create import format configurations for external tracking data.

Based on REQ-TRACK-IMPORT:

formats:
  # FBX camera import
  fbx:
    description: "FBX camera tracking data"
    extensions: [".fbx"]
    coordinate_system:
      up: "Y"  # FBX default is Y-up
      forward: "-Z"
      convert_to_blender: true  # Blender is Z-up
    camera_import:
      import_focal: true
      import_aperture: true
      import_animation: true
      import_lens_distortion: true
    scale_factor: 0.01  # cm to m

  # Nuke .chan
  nuke_chan:
    description: "Nuke camera channel file"
    extensions: [".chan"]
    columns: ["frame", "tx", "ty", "tz", "rx", "ry", "rz", "focal"]
    frame_column: 0
    delimiter: "space"
    rotation_order: "XYZ"
    coordinate_system:
      up: "Y"
      convert_to_blender: true

  # Alembic
  alembic:
    description: "Alembic animation cache"
    extensions: [".abc"]
    camera_import:
      import_camera: true
      import_transforms: true
      import_geometry: false
    frame_rate: "from_file"

  # BVH motion capture
  bvh:
    description: "Biovision Hierarchy motion capture"
    extensions: [".bvh"]
    import:
      import_skeleton: true
      import_animation: true
      retarget_to_metarig: false
    scale_factor: 0.01

  # JSON custom format
  json:
    description: "Custom JSON tracking format"
    extensions: [".json"]
    schema_version: "1.0"
    structure:
      frames: "List of frame objects"
      frame: "frame_number, camera_transform, focal_length"

  # 3DEqualizer Python export
  3dequalizer:
    description: "3DEqualizer Python script export"
    extensions: [".py"]
    export_type: "python_script"
    includes:
      - camera_animation
      - point_cloud
      - lens_distortion
</action>
  <verify>
python3 -c "
import yaml
with open('configs/cinematic/tracking/import_formats.yaml') as f:
    data = yaml.safe_load(f)
assert 'formats' in data
assert 'fbx' in data['formats']
assert 'nuke_chan' in data['formats']
assert data['formats']['fbx']['coordinate_system']['up'] == 'Y'
print('import_formats.yaml is valid YAML with expected structure')
"
  </verify>
  <done>
- import_formats.yaml exists with 6 format definitions
- YAML is valid and parseable
- Each format has coordinate_system info for conversion
  </done>
</task>

</tasks>

<verification>
# Phase-level verification
1. All 3 YAML files exist and are valid
2. Each follows the config directory structure
3. camera_profiles.yaml remains unchanged (already exists from Phase 6.9)
4. All configs can be loaded with yaml.safe_load()
</verification>

<success_criteria>
- configs/cinematic/tracking/tracking_presets.yaml exists with 4 presets
- configs/cinematic/tracking/solver_settings.yaml exists with 4 settings
- configs/cinematic/tracking/import_formats.yaml exists with 6 formats
- All YAML files parse correctly
</success_criteria>

<output>
After completion, create `.planning/phases/07.0-tracking-foundation/07.0-02-SUMMARY.md`
</output>
