# Phase 10.1: Wardrobe System

**Phase**: 10.1
**Priority**: P1
**Dependencies**: Phase 8.x (Development Department)
**Est. Duration**: 4-5 days

---

## Goal

Implement comprehensive costume tracking system that manages character wardrobe across all scenes with continuity validation.

---

## Requirements

- REQ-WARD-01: Costume definition and storage
- REQ-WARD-02: Scene-by-scene costume assignment
- REQ-WARD-03: Automatic costume change detection
- REQ-WARD-04: Continuity validation
- REQ-WARD-05: Costume bible generation

---

## Plans

### Plan 10.1-01: Wardrobe Types

**Deliverable**: `lib/character/wardrobe_types.py`

```python
@dataclass
class CostumePiece:
    """Single piece of clothing or accessory."""
    name: str
    category: str  # top, bottom, shoes, accessory, outerwear, underwear
    color: str
    material: str
    style: str  # casual, formal, athletic, period, fantasy
    brand: str = ""
    notes: str = ""

@dataclass
class Costume:
    """Complete costume for a character."""
    name: str
    character: str
    pieces: List[CostumePiece]
    accessories: List[CostumePiece]
    colors: List[str]  # Primary colors for continuity
    condition: str = "pristine"  # pristine, worn, dirty, damaged, bloodied
    notes: str = ""

    def get_piece(self, category: str) -> Optional[CostumePiece]:
        """Get piece by category."""
        pass

    def matches(self, other: "Costume") -> bool:
        """Check if two costumes match (continuity check)."""
        pass

@dataclass
class CostumeChange:
    """Costume change between scenes."""
    character: str
    scene_before: int
    scene_after: int
    costume_before: str  # Costume name
    costume_after: str
    change_reason: str  # story, time, location, damage, weather
    notes: str = ""

@dataclass
class CostumeAssignment:
    """Costume assignment for a scene."""
    character: str
    scene: int
    costume: str  # Costume name
    condition: str = "pristine"
    modifications: List[str] = field(default_factory=list)  # On-set modifications

@dataclass
class WardrobeRegistry:
    """Complete wardrobe registry for production."""
    costumes: Dict[str, Costume]  # name -> Costume
    assignments: List[CostumeAssignment]
    changes: List[CostumeChange]
    characters: Dict[str, List[str]]  # character -> costume names
```

**Tasks**:
1. Create all dataclasses
2. Implement serialization
3. Implement matching/comparison methods
4. Implement registry management methods

---

### Plan 10.2-02: Costume Manager

**Deliverable**: `lib/character/costume_manager.py`

```python
class CostumeManager:
    """Manages costumes for a production."""

    def __init__(self):
        self.registry = WardrobeRegistry()

    # Costume CRUD
    def create_costume(self, costume: Costume) -> None:
        """Add costume to registry."""
        pass

    def get_costume(self, name: str) -> Optional[Costume]:
        """Get costume by name."""
        pass

    def update_costume(self, name: str, costume: Costume) -> None:
        """Update existing costume."""
        pass

    def delete_costume(self, name: str) -> None:
        """Remove costume from registry."""
        pass

    # Assignment
    def assign_costume(self, character: str, scene: int, costume_name: str, condition: str = "pristine") -> None:
        """Assign costume to character for scene."""
        pass

    def get_costume_for_scene(self, character: str, scene: int) -> Optional[CostumeAssignment]:
        """Get costume assignment for scene."""
        pass

    def get_character_scenes(self, character: str) -> List[CostumeAssignment]:
        """Get all scenes with costume for character."""
        pass

    # Change tracking
    def detect_costume_changes(self) -> List[CostumeChange]:
        """Detect costume changes between consecutive scenes."""
        pass

    def record_change(self, change: CostumeChange) -> None:
        """Record a costume change."""
        pass

    # Query
    def get_all_costumes_for_character(self, character: str) -> List[Costume]:
        """Get all costumes used by character."""
        pass

    def get_costume_usage(self, costume_name: str) -> List[int]:
        """Get all scenes where costume is used."""
        pass
```

**Tasks**:
1. Implement CostumeManager class
2. Implement all CRUD operations
3. Implement assignment system
4. Implement change detection
5. Add query methods

---

### Plan 10.1-03: Continuity Validator

**Deliverable**: `lib/character/continuity_validator.py`

```python
@dataclass
class ContinuityIssue:
    """Represents a continuity problem."""
    issue_type: str  # costume_mismatch, condition_mismatch, missing_assignment
    character: str
    scene: int
    description: str
    severity: str  # error, warning, info
    suggestion: str = ""

@dataclass
class ContinuityReport:
    """Complete continuity validation report."""
    production: str
    generated_at: datetime
    issues: List[ContinuityIssue]
    by_character: Dict[str, List[ContinuityIssue]]
    by_scene: Dict[int, List[ContinuityIssue]]
    summary: Dict[str, int]

def validate_continuity(registry: WardrobeRegistry) -> ContinuityReport:
    """Validate wardrobe continuity across all scenes."""
    pass

def check_costume_consistency(character: str, registry: WardrobeRegistry) -> List[ContinuityIssue]:
    """Check costume consistency for character."""
    pass

def check_condition_progression(character: str, registry: WardrobeRegistry) -> List[ContinuityIssue]:
    """Check if condition changes make sense (e.g., can't go from damaged to pristine)."""
    pass

def suggest_costume_changes(registry: WardrobeRegistry) -> List[str]:
    """Suggest where costume changes might be needed."""
    pass
```

**Tasks**:
1. Implement continuity validation
2. Implement consistency checking
3. Implement condition progression checking
4. Implement suggestion system
5. Generate reports in multiple formats

---

### Plan 10.1-04: Costume Bible Generator

**Deliverable**: `lib/character/costume_bible.py`

```python
@dataclass
class CostumeBible:
    """Production costume bible document."""
    production: str
    characters: Dict[str, CharacterWardrobe]
    color_palettes: Dict[str, List[str]]
    shopping_list: List[ShoppingItem]
    scene_breakdown: Dict[int, Dict[str, str]]  # scene -> character -> costume

@dataclass
class CharacterWardrobe:
    """Complete wardrobe for a character."""
    character: str
    total_costumes: int
    costumes: List[Costume]
    scene_breakdown: List[Tuple[int, str, str]]  # scene, costume, condition
    color_theme: List[str]

def generate_costume_bible(registry: WardrobeRegistry, production_name: str) -> CostumeBible:
    """Generate complete costume bible."""
    pass

def export_bible_pdf(bible: CostumeBible, path: str) -> None:
    """Export bible as PDF."""
    pass

def export_bible_html(bible: CostumeBible, path: str) -> None:
    """Export bible as HTML."""
    pass

def export_bible_yaml(bible: CostumeBible, path: str) -> None:
    """Export bible as YAML."""
    pass

def generate_shopping_list(registry: WardrobeRegistry) -> List[ShoppingItem]:
    """Generate shopping/acquisition list."""
    pass
```

**Tasks**:
1. Implement bible generation
2. Implement PDF export (via reportlab or weasyprint)
3. Implement HTML export
4. Implement YAML export
5. Implement shopping list generation

---

### Plan 10.1-05: Integration & YAML Storage

**Deliverable**: `configs/production/wardrobe/` structure

```yaml
# example: wardrobe/hero_costumes.yaml
character: "Hero"
costumes:
  - name: "hero_casual"
    pieces:
      - name: "T-Shirt"
        category: "top"
        color: "navy blue"
        material: "cotton"
      - name: "Jeans"
        category: "bottom"
        color: "dark blue"
        material: "denim"
      - name: "Sneakers"
        category: "shoes"
        color: "white"
        material: "canvas"
    condition: "pristine"

  - name: "hero_formal"
    pieces:
      - name: "Suit Jacket"
        category: "outerwear"
        color: "charcoal"
        material: "wool"
      # ... more pieces

assignments:
  - scene: 1
    costume: "hero_casual"
    condition: "pristine"
  - scene: 5
    costume: "hero_formal"
    condition: "pristine"
  - scene: 6
    costume: "hero_formal"
    condition: "dirty"
    notes: "After fight scene"
```

**Tasks**:
1. Create YAML schema
2. Implement YAML loader
3. Implement YAML saver
4. Create example files
5. Update __init__.py

---

## Acceptance Criteria

- [ ] Costumes can be created and stored
- [ ] Scene assignments work correctly
- [ ] Costume changes detected automatically
- [ ] Continuity validation catches errors
- [ ] Costume bible generates correctly
- [ ] YAML storage works bidirectionally

---

## Files

```
lib/character/
├── __init__.py
├── wardrobe_types.py       # Data structures
├── costume_manager.py      # CRUD operations
├── continuity_validator.py # Validation
└── costume_bible.py        # Bible generation

configs/production/wardrobe/
├── schema.yaml             # YAML schema
├── examples/
│   ├── hero_costumes.yaml
│   └── villain_costumes.yaml
└── templates/
    └── character_template.yaml
```
