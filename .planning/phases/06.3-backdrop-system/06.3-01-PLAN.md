---
phase: 06.3-backdrop-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/cinematic/types.py
  - lib/cinematic/preset_loader.py
autonomous: true

must_haves:
  truths:
    - "BackdropConfig supports all backdrop types (infinite_curve, gradient, hdri, mesh)"
    - "Preset loaders can load infinite curve presets"
    - "Preset loaders can load gradient presets"
    - "Preset loaders can load environment presets"
  artifacts:
    - path: "lib/cinematic/types.py"
      provides: "Extended BackdropConfig with all properties"
      contains: "backdrop_type"
    - path: "lib/cinematic/preset_loader.py"
      provides: "Backdrop preset loading functions"
      exports: ["get_infinite_curve_preset", "get_gradient_preset", "get_environment_preset"]
  key_links:
    - from: "lib/cinematic/preset_loader.py"
      to: "configs/cinematic/backdrops/"
      via: "load_preset()"
      pattern: "BACKDROP_CONFIG_ROOT"
---

<objective>
Extend BackdropConfig and add backdrop preset loader functions.

Purpose: Provide complete type definitions and preset loading infrastructure for the backdrop system. The existing BackdropConfig is minimal and needs additional properties for all backdrop types.
Output: Extended BackdropConfig dataclass, three new preset loader functions, and list functions for discovery.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing patterns to follow
@lib/cinematic/types.py
@lib/cinematic/preset_loader.py
@configs/cinematic/backdrops/infinite_curves.yaml
@configs/cinematic/backdrops/gradients.yaml
@configs/cinematic/backdrops/environments.yaml

# Research findings
@.planning/phases/06.3-backdrop-system/06.3-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend BackdropConfig in types.py</name>
  <files>lib/cinematic/types.py</files>
  <action>
Extend the existing `BackdropConfig` dataclass (around line 335) with additional properties needed for all backdrop types.

Current BackdropConfig has:
- backdrop_type, color_bottom, color_top, radius, shadow_catcher

Add these properties:
- curve_height: float = 3.0  # Height of vertical wall for infinite curves
- curve_segments: int = 32   # Resolution of curve
- gradient_type: str = "linear"  # linear, radial, angular for gradient backdrops
- gradient_stops: List[Dict] = field(default_factory=list)  # Gradient color stops
- hdri_preset: str = ""      # Name of HDRI preset for HDRI backdrops
- mesh_file: str = ""        # Path to mesh file for mesh backdrops
- mesh_scale: float = 1.0    # Scale for mesh environments

Update the to_dict() and from_dict() methods to include all new properties.

Follow the exact pattern used by LightConfig and GelConfig for consistency.
  </action>
  <verify>python3 -c "
from lib.cinematic.types import BackdropConfig

# Test instantiation with new properties
c = BackdropConfig()
assert c.curve_height == 3.0, 'curve_height default failed'
assert c.curve_segments == 32, 'curve_segments default failed'
assert c.gradient_type == 'linear', 'gradient_type default failed'
assert c.hdri_preset == '', 'hdri_preset default failed'

# Test round-trip serialization
data = c.to_dict()
c2 = BackdropConfig.from_dict(data)
assert c2.curve_height == c.curve_height, 'round-trip curve_height failed'
assert c2.curve_segments == c.curve_segments, 'round-trip curve_segments failed'
assert c2.gradient_type == c.gradient_type, 'round-trip gradient_type failed'
print('BackdropConfig extended OK, round-trip serialization OK')
"</verify>
  <done>BackdropConfig supports all backdrop types with proper serialization including round-trip to_dict/from_dict</done>
</task>

<task type="auto">
  <name>Task 2: Add backdrop preset loaders to preset_loader.py</name>
  <files>lib/cinematic/preset_loader.py</files>
  <action>
Add backdrop preset loader functions following the exact pattern of existing lighting loaders (get_lighting_rig_preset, get_gel_preset, get_hdri_preset).

First, add a new constant near the top of the file:
```python
BACKDROP_CONFIG_ROOT = Path("configs/cinematic/backdrops")
```

Then add these three loader functions:

1. `get_infinite_curve_preset(name: str) -> Dict[str, Any]`
   - Load from `BACKDROP_CONFIG_ROOT / "infinite_curves.yaml"`
   - Access `curves` key in the YAML
   - Raise ValueError if preset not found with available names

2. `get_gradient_preset(name: str) -> Dict[str, Any]`
   - Load from `BACKDROP_CONFIG_ROOT / "gradients.yaml"`
   - Access `gradients` key in the YAML
   - Raise ValueError if preset not found

3. `get_environment_preset(name: str) -> Dict[str, Any]`
   - Load from `BACKDROP_CONFIG_ROOT / "environments.yaml"`
   - Access `environments` key in the YAML
   - Raise ValueError if preset not found

Then add list functions:

4. `list_infinite_curve_presets() -> List[str]`
5. `list_gradient_presets() -> List[str]`
6. `list_environment_presets() -> List[str]`

Follow the exact pattern of list_lighting_rig_presets() and list_gel_presets().
  </action>
  <verify>python3 -c "from lib.cinematic.preset_loader import get_infinite_curve_preset, list_infinite_curve_presets; p = get_infinite_curve_preset('white_studio'); assert p['radius'] == 5.0; print('Preset loaders OK')"</verify>
  <done>All three preset types loadable with list functions working</done>
</task>

</tasks>

<verification>
1. BackdropConfig can be instantiated with new properties
2. BackdropConfig to_dict/from_dict round-trips correctly
3. All three preset loaders can load from existing YAML files
4. All three list functions return available presets
</verification>

<success_criteria>
- BackdropConfig extended with all new properties
- get_infinite_curve_preset(), get_gradient_preset(), get_environment_preset() work
- list_infinite_curve_presets(), list_gradient_presets(), list_environment_presets() work
- Pattern matches existing preset loaders in the file
</success_criteria>

<output>
After completion, create `.planning/phases/06.3-backdrop-system/06.3-01-SUMMARY.md`
</output>
