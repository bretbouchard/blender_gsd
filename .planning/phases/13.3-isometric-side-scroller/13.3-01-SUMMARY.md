# Phase 13.3: Isometric & Side-Scroller Summary

**Phase**: 13.3
**Plan**: 13.3-01
**Status**: Complete
**Duration**: 2026-02-20
**Commit**: 8ebceea

---

## One-Liner

Isometric and side-scroller camera systems with parallax layers, sprite sheet generation (4 formats), and tile-based output for game asset creation from 3D scenes.

---

## Requirements Satisfied

| ID | Requirement | Status |
|----|-------------|--------|
| REQ-RETRO-04 | Isometric projection with multiple angles | Complete |
| REQ-RETRO-05 | Side-scroller view with parallax layers | Complete |
| REQ-RETRO-07 | Sprite sheet generation | Complete |
| REQ-RETRO-08 | Tile-based output | Complete |

---

## Files Created

### lib/retro/

| File | Lines | Purpose |
|------|-------|---------|
| isometric_types.py | 820 | Data structures, enums, configs for isometric/side-scroller/sprites/tiles |
| isometric.py | 525 | Isometric camera, projection math, depth sorting, grid, rendering |
| side_scroller.py | 470 | Side-scroller camera, parallax layers, animation, depth assignment |
| sprites.py | 540 | Sprite sheet generation, trimming, metadata, 4 format exporters |
| tiles.py | 580 | Tile sets, tile maps, autotile, collision maps, transforms |
| view_preset_loader.py | 280 | YAML preset loader with caching |

### configs/cinematic/retro/

| File | Purpose |
|------|---------|
| view_presets.yaml | 35 presets across 4 categories |

### tests/

| File | Tests | Purpose |
|------|-------|---------|
| test_isometric.py | 55 | Types, configs, enums, built-in presets |
| test_isometric_camera.py | 29 | Camera, projection, depth sorting, grid |
| test_side_scroller.py | 27 | Parallax, depth assignment, animation |
| test_sprites.py | 30 | Sheet generation, trimming, exporters |
| test_tiles.py | 53 | Tile sets, maps, autotile, collision |
| test_view_preset_loader.py | 40 | Preset loading and caching |

---

## Key Components

### IsometricConfig

```python
from lib.retro import IsometricConfig, create_isometric_camera_config

# Use preset
config = IsometricConfig.for_game_style("classic_pixel")
cam_config = create_isometric_camera_config(config)

# Or customize
config = IsometricConfig(
    angle="pixel",  # 2:1 ratio
    tile_width=64,
    tile_height=32,
    depth_sorting=True,
    custom_elevation=27.0,  # Fallout style
    custom_rotation=45.0
)
```

### Angle Presets (7 built-in)

- **true_isometric**: Equal angles (35.264 degrees elevation)
- **pixel**: Classic 2:1 ratio (30 degrees)
- **pixel_perfect**: Mathematically exact 2:1 (26.565 degrees)
- **military**: Planometric (45 degrees)
- **dimetric**: Custom angles (30/30)
- **blizzard**: StarCraft/Warcraft style
- **fallout**: Fallout 1/2 style (27 degrees)

### SideScrollerConfig

```python
from lib.retro import SideScrollerConfig, separate_parallax_layers

config = SideScrollerConfig.for_style("platformer_16bit")
layers = separate_parallax_layers(scene, config)

for layer in layers:
    print(f"{layer.name}: depth={layer.depth}, objects={len(layer.objects)}")
```

### Sprite Sheet Generation

```python
from lib.retro import SpriteSheetConfig, generate_sprite_sheet

config = SpriteSheetConfig.for_character(32, 32)
result = generate_sprite_sheet(images, config)

# Result contains:
# - result.image: PIL Image of sprite sheet
# - result.metadata: Dict in specified format
# - result.frame_count: Number of frames
# - result.trimmed_count: Frames that were trimmed
```

### Export Formats (4)

- **Phaser**: Phaser.js JSON with frames dict
- **Unity**: Unity sprite data format
- **Godot**: Godot animation format with duration
- **Generic**: Simple format with config

### Tile System

```python
from lib.retro import TileConfig, generate_tile_map, export_tile_map

config = TileConfig.for_console("nes")
tile_map = generate_tile_map(scene, isometric_config)
export_tile_map(tile_map, "level.csv", "csv")

# With autotile
from lib.retro import apply_autotile
result = apply_autotile(tile_map, target_id=1)
```

---

## Presets

### Isometric (9)

| Name | Angle | Tile Size | Use Case |
|------|-------|-----------|----------|
| classic_pixel | pixel | 64x32 | Classic 2:1 games |
| true_iso | true_isometric | 64x64 | Equal angles |
| strategy | military | 64x64 | Strategy games |
| blizzard | blizzard | 64x32 | RTS games |
| fallout | fallout | 80x36 | RPGs |
| pixel_perfect | pixel_perfect | 64x32 | Math-accurate |
| mobile_small | pixel | 32x16 | Mobile |
| hd_large | pixel | 128x64 | HD assets |
| dimetric | dimetric | 48x24 | Custom angles |

### Side-Scroller (8)

| Name | Layers | Use Case |
|------|--------|----------|
| platformer_16bit | 4 | SNES-era platformers |
| simple | 2 | Basic parallax |
| cinematic | 6 | Rich backgrounds |
| endless_runner | 3 | Fast-paced runners |
| minimal | 1 | No parallax |
| top_down | 1 | Top-down view |
| front_view | 4 | 2.5D games |
| nes_style | 2 | 8-bit style |

### Sprite Sheet (10)

| Name | Grid | Size | Format |
|------|------|------|--------|
| character | 8x4 | 32x32 | phaser |
| character_hd | 8x4 | 64x64 | phaser |
| tileset | 16x16 | 16x16 | generic |
| tileset_large | 8x8 | 32x32 | generic |
| effects | 8x8 | 64x64 | phaser |
| ui_elements | 10x10 | 24x24 | generic |
| walk_cycle | 8x1 | 32x32 | phaser |
| character_full | 8x8 | 32x32 | phaser |
| unity_character | 8x4 | 32x32 | unity |
| godot_character | 8x4 | 32x32 | godot |

### Tile (8)

| Name | Size | Features |
|------|------|----------|
| nes | 16x16 | CSV map |
| snes | 16x16 | Collision |
| modern_32 | 32x32 | TMX, autotile |
| modern_64 | 64x64 | TMX, autotile |
| isometric_32 | 32x16 | JSON map |
| isometric_64 | 64x32 | JSON map |
| isometric_hd | 128x64 | JSON map |
| padded | 32x32 | Padding/spacing |

---

## Test Results

```
tests/test_isometric.py .................... 55 passed
tests/test_isometric_camera.py ............. 29 passed
tests/test_side_scroller.py ................ 27 passed
tests/test_sprites.py ...................... 30 passed
tests/test_tiles.py ........................ 53 passed
tests/test_view_preset_loader.py ........... 40 passed

Total: 234 passed in 0.46s
```

---

## API Exports

Module version: 0.2.0

```python
from lib.retro import (
    # Enums
    IsometricAngle, ViewDirection, SpriteFormat, TileFormat,

    # Configs
    IsometricConfig, SideScrollerConfig, SpriteSheetConfig, TileConfig,

    # Results
    IsometricRenderResult, SpriteSheetResult, TileSetResult,

    # Isometric
    create_isometric_camera_config,
    project_to_isometric,
    depth_sort_objects,
    render_isometric_tile,

    # Side-Scroller
    separate_parallax_layers,
    calculate_parallax_offset,
    render_parallax_layer,

    # Sprites
    generate_sprite_sheet,
    export_phaser_json,
    export_unity_json,
    export_godot_json,

    # Tiles
    render_tile_set,
    generate_tile_map,
    export_tile_map,
    apply_autotile,

    # Presets
    load_isometric_preset,
    load_side_scroller_preset,
    load_sprite_sheet_preset,
    load_tile_preset,
)
```

---

## Next Phase Readiness

### Completed

- All 4 requirements implemented
- 234 unit tests passing
- 35 presets across 4 categories
- Full API documentation in docstrings

### Integration Points

- Works with existing `lib.retro` pixel art system
- Compatible with `PixelationConfig` for combining effects
- Presets load from `configs/cinematic/retro/view_presets.yaml`

### Blockers

None. Phase complete.

---

## Decisions Made

| Decision | Rationale |
|----------|-----------|
| 2:1 pixel ratio as default | Most common for games (SimCity, Diablo, etc.) |
| PIL for sprite sheet generation | Cross-platform, no Blender dependency |
| 4 export formats | Cover major game engines |
| 16-tile autotile template | Standard blob tile approach |
| YAML presets | Human-readable, easy to extend |

---

## Deviations from Plan

None - plan executed exactly as written.
