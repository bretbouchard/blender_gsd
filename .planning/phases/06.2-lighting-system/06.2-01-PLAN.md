---
phase: 06.2-lighting-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/cinematic/types.py
  - lib/cinematic/enums.py
  - lib/cinematic/preset_loader.py
autonomous: true
must_haves:
  truths:
    - "LightConfig supports all light-type-specific properties"
    - "GelConfig dataclass exists for gel presets"
    - "HDRIConfig dataclass exists for HDRI presets"
    - "LightRigConfig dataclass exists for rig presets"
    - "Preset loader can load lighting, gel, and HDRI presets"
  artifacts:
    - path: "lib/cinematic/types.py"
      provides: "Extended LightConfig, GelConfig, HDRIConfig, LightRigConfig dataclasses"
      contains: "class LightConfig"
      min_lines: 200
    - path: "lib/cinematic/enums.py"
      provides: "AreaLightShape enum for area light shapes"
      contains: "class AreaLightShape"
    - path: "lib/cinematic/preset_loader.py"
      provides: "get_lighting_rig_preset, get_gel_preset, get_hdri_preset functions"
      exports: ["get_lighting_rig_preset", "get_gel_preset", "get_hdri_preset"]
  key_links:
    - from: "lib/cinematic/types.py"
      to: "lib/cinematic/lighting.py"
      via: "LightConfig import"
      pattern: "from .types import LightConfig"
    - from: "lib/cinematic/preset_loader.py"
      to: "configs/cinematic/lighting/*.yaml"
      via: "load_preset"
      pattern: "load_preset.*lighting"
---

<objective>
Extend types and preset loader for lighting system foundation.

Purpose: Create the data structures needed to configure all light types, gels, HDRIs, and lighting rigs. The existing LightConfig only has basic properties - we need light-type-specific fields for area lights (shape, size, spread), spot lights (spot_size, spot_blend), and configuration classes for gels and HDRIs.

Output:
- Extended LightConfig with type-specific properties
- GelConfig, HDRIConfig, LightRigConfig dataclasses
- AreaLightShape enum
- Lighting preset loader functions
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06.2-lighting-system/06.2-RESEARCH.md

# Existing patterns to follow
@lib/cinematic/types.py
@lib/cinematic/enums.py
@lib/cinematic/preset_loader.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend LightConfig dataclass</name>
  <files>lib/cinematic/types.py</files>
  <action>
Extend the existing LightConfig dataclass in lib/cinematic/types.py to support light-type-specific properties:

1. Add these new fields to LightConfig (all optional with defaults):
   - shape: str = "RECTANGLE" (for area lights: SQUARE, RECTANGLE, DISK, ELLIPSE - must be uppercase)
   - size: float = 1.0 (width/radius for area lights)
   - size_y: float = 1.0 (height for RECTANGLE/ELLIPSE area lights)
   - spread: float = 1.047 (spread angle in radians for area lights, default 60 degrees)
   - spot_size: float = 0.785 (cone angle in radians for spot lights, default 45 degrees)
   - spot_blend: float = 0.5 (edge softness 0-1 for spot lights)
   - shadow_soft_size: float = 0.1 (shadow softness radius)
   - use_temperature: bool = False (Blender 4.0+ color temperature mode)
   - temperature: float = 6500.0 (color temperature in Kelvin when use_temperature=True)
   - use_shadow: bool = True

2. Update to_dict() to include all new fields
3. Update from_dict() to read all new fields with defaults

IMPORTANT: Do NOT break existing LightConfig usage. The existing fields (name, light_type, intensity, color, transform) must remain as-is.
</action>
  <verify>python3 -c "from lib.cinematic.types import LightConfig; c = LightConfig(shape='DISK', spot_size=1.57, use_temperature=True, temperature=3200); print(c.to_dict())"</verify>
  <done>LightConfig extended with all type-specific fields, existing functionality preserved, to_dict/from_dict work correctly</done>
</task>

<task type="auto">
  <name>Task 2: Create lighting config dataclasses</name>
  <files>lib/cinematic/types.py</files>
  <action>
Add three new dataclasses to lib/cinematic/types.py:

1. GelConfig dataclass:
   - name: str = "none"
   - color: Tuple[float, float, float] = (1.0, 1.0, 1.0)
   - temperature_shift: float = 0.0
   - softness: float = 0.0
   - transmission: float = 1.0
   - combines: List[str] = field(default_factory=list)
   - to_dict() and from_dict() methods

2. HDRIConfig dataclass:
   - name: str = "studio_bright"
   - file: str = "" (path to HDRI file)
   - exposure: float = 0.0
   - rotation: float = 0.0
   - background_visible: bool = False
   - saturation: float = 1.0
   - to_dict() and from_dict() methods

3. LightRigConfig dataclass:
   - name: str = "three_point_soft"
   - description: str = ""
   - extends: str = "" (for preset inheritance)
   - lights: Dict[str, Dict[str, Any]] = field(default_factory=dict)
   - hdri: Optional[Dict[str, Any]] = None
   - to_dict() and from_dict() methods

Place these after LightConfig, before BackdropConfig. Follow the same dataclass pattern used in the file.
</action>
  <verify>python3 -c "from lib.cinematic.types import GelConfig, HDRIConfig, LightRigConfig; g = GelConfig(name='cto_full', color=(1.0, 0.77, 0.56)); h = HDRIConfig(name='studio', file='test.hdr', exposure=0.5); r = LightRigConfig(name='test'); print(g.to_dict(), h.to_dict(), r.to_dict())"</verify>
  <done>GelConfig, HDRIConfig, LightRigConfig dataclasses created with to_dict/from_dict methods</done>
</task>

<task type="auto">
  <name>Task 3: Add AreaLightShape enum</name>
  <files>lib/cinematic/enums.py</files>
  <action>
Add a new enum to lib/cinematic/enums.py after LightType enum:

```python
class AreaLightShape(Enum):
    """
    Shape options for area lights.

    Maps to Blender area light shapes (must be uppercase).
    """
    SQUARE = "SQUARE"
    RECTANGLE = "RECTANGLE"
    DISK = "DISK"
    ELLIPSE = "ELLIPSE"
```

Place after LightType enum, before QualityTier enum.
</action>
  <verify>python3 -c "from lib.cinematic.enums import AreaLightShape; print(AreaLightShape.DISK.value)"</verify>
  <done>AreaLightShape enum added with SQUARE, RECTANGLE, DISK, ELLIPSE values</done>
</task>

<task type="auto">
  <name>Task 4: Add lighting preset loaders</name>
  <files>lib/cinematic/preset_loader.py</files>
  <action>
Add three new preset loader functions to lib/cinematic/preset_loader.py:

1. Add constant at top (after CONFIG_ROOT):
   ```python
   LIGHTING_CONFIG_ROOT = Path("configs/cinematic/lighting")
   ```

2. get_lighting_rig_preset(name: str) -> Dict[str, Any]:
   - Load from LIGHTING_CONFIG_ROOT / "rig_presets.yaml"
   - Get from "rigs" key
   - Same error handling pattern as existing functions

3. get_gel_preset(name: str) -> Dict[str, Any]:
   - Load from LIGHTING_CONFIG_ROOT / "gel_presets.yaml"
   - Get from "gels" key
   - Same error handling pattern

4. get_hdri_preset(name: str) -> Dict[str, Any]:
   - Load from LIGHTING_CONFIG_ROOT / "hdri_presets.yaml"
   - Get from "hdri" key
   - Same error handling pattern

5. Add list_* functions:
   - list_lighting_rig_presets()
   - list_gel_presets()
   - list_hdri_presets()

Follow the exact pattern used in get_lens_preset() and list_lens_presets().
</action>
  <verify>python3 -c "from lib.cinematic.preset_loader import get_gel_preset, list_lighting_rig_presets; print(get_gel_preset('cto_full')); print(list_lighting_rig_presets())"</verify>
  <done>get_lighting_rig_preset, get_gel_preset, get_hdri_preset functions work with existing YAML presets</done>
</task>

</tasks>

<verification>
1. All new types importable: python3 -c "from lib.cinematic.types import LightConfig, GelConfig, HDRIConfig, LightRigConfig"
2. All enums importable: python3 -c "from lib.cinematic.enums import LightType, AreaLightShape"
3. Preset loaders work: python3 -c "from lib.cinematic.preset_loader import get_lighting_rig_preset, get_gel_preset, get_hdri_preset"
4. Existing camera functionality still works: python3 -c "from lib.cinematic.types import CameraConfig; c = CameraConfig()"
</verification>

<success_criteria>
- LightConfig has shape, size, spread, spot_size, spot_blend fields
- GelConfig, HDRIConfig, LightRigConfig dataclasses exist with to_dict/from_dict
- AreaLightShape enum has SQUARE, RECTANGLE, DISK, ELLIPSE values
- get_lighting_rig_preset, get_gel_preset, get_hdri_preset functions exist
- list_*_presets functions exist for each preset type
- All preset loaders work with existing YAML files
- No breaking changes to existing code
</success_criteria>

<output>
After completion, create `.planning/phases/06.2-lighting-system/06.2-01-SUMMARY.md`
</output>
