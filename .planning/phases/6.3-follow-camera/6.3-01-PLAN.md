# Phase 6.3: Follow Camera System

**Phase**: 6.3
**Priority**: P0
**Dependencies**: Phase 6.1 (Camera System), Phase 6.2 (Motion Tracking)
**Est. Duration**: 3-4 days

---

## Goal

Implement intelligent camera following system that creates natural, cinematic camera movement when tracking subjects.

---

## Requirements

- REQ-FOLLOW-01: Subject following with configurable modes
- REQ-FOLLOW-02: Look-ahead prediction
- REQ-FOLLOW-03: Dead zones for stable framing
- REQ-FOLLOW-04: Obstacle awareness
- REQ-FOLLOW-05: Smooth interpolation modes

---

## Plans

### Plan 6.3-01: Follow Camera Types

**Deliverable**: `lib/cinematic/follow_types.py`

```python
@dataclass
class FollowConfig:
    """Configuration for camera following behavior."""
    mode: str = "loose"  # tight, loose, anticipatory, elastic
    dead_zone: Tuple[float, float] = (0.1, 0.1)  # Screen space % before moving
    look_ahead_frames: int = 10
    smoothing: float = 0.3  # 0=immediate, 1=very slow
    max_speed: float = 2.0  # meters per frame
    acceleration: float = 0.1  # speed change per frame
    offset: Tuple[float, float, float] = (0, 0, 0)  # Offset from subject
    keep_distance: float = 3.0  # Preferred subject distance
    keep_height: float = 1.6  # Preferred camera height

@dataclass
class FollowRig:
    """Camera rig that follows a subject."""
    name: str
    camera: str  # Camera object name
    target: str  # Target object/marker name
    config: FollowConfig
    state: FollowState

@dataclass
class FollowState:
    """Current state of follow rig."""
    current_velocity: Tuple[float, float, float] = (0, 0, 0)
    target_position: Tuple[float, float, float] = (0, 0, 0)
    is_in_dead_zone: bool = True
    frames_since_move: int = 0
```

**Tasks**:
1. Create FollowConfig with all parameters
2. Create FollowRig structure
3. Create FollowState for tracking runtime state

---

### Plan 6.3-02: Follow Modes

**Deliverable**: `lib/cinematic/follow_modes.py`

```python
# Follow Mode Implementations

def follow_tight(camera_pos, target_pos, config: FollowConfig) -> Tuple[float, float, float]:
    """Tight following - camera stays centered on subject."""
    # Immediate response, minimal smoothing
    pass

def follow_loose(camera_pos, target_pos, config: FollowConfig) -> Tuple[float, float, float]:
    """Loose following - camera lags behind subject movement."""
    # Smooth delay, natural feel
    pass

def follow_anticipatory(camera_pos, target_pos, velocity, config: FollowConfig) -> Tuple[float, float, float]:
    """Anticipatory - camera moves before subject arrives."""
    # Uses velocity prediction
    pass

def follow_elastic(camera_pos, target_pos, config: FollowConfig) -> Tuple[float, float, float]:
    """Elastic - camera snaps back to center with spring physics."""
    # Spring-like behavior
    pass

def follow_orbit(camera_pos, target_pos, angle, config: FollowConfig) -> Tuple[float, float, float]:
    """Orbit - camera circles subject while following."""
    pass
```

**Tasks**:
1. Implement tight mode (linear interpolation)
2. Implement loose mode (exponential smoothing)
3. Implement anticipatory mode (velocity prediction)
4. Implement elastic mode (spring physics)
5. Implement orbit mode (circular path)

---

### Plan 6.3-03: Dead Zone System

**Deliverable**: `lib/cinematic/follow_deadzone.py`

```python
def calculate_screen_position(camera, target_pos) -> Tuple[float, float]:
    """Calculate where target appears in camera frame (0-1)."""
    pass

def is_in_dead_zone(screen_pos: Tuple[float, float], dead_zone: Tuple[float, float]) -> bool:
    """Check if target is within dead zone."""
    pass

def calculate_dead_zone_reaction(screen_pos, dead_zone, strength) -> Tuple[float, float, float]:
    """Calculate camera movement needed to recenter."""
    pass

def create_dynamic_dead_zone(velocity: Tuple[float, float, float], base_size: float) -> Tuple[float, float]:
    """Create dead zone that expands with speed."""
    pass
```

**Tasks**:
1. Implement screen position calculation
2. Implement dead zone detection
3. Implement reaction calculation
4. Implement dynamic dead zones

---

### Plan 6.3-04: Follow Controller

**Deliverable**: `lib/cinematic/follow_controller.py`

```python
def create_follow_rig(camera_name: str, target_name: str, config: FollowConfig) -> FollowRig:
    """Create a follow rig for camera."""
    pass

def update_follow_rig(rig: FollowRig, frame: int):
    """Update camera position for frame."""
    pass

def bake_follow_animation(rig: FollowRig, frame_start: int, frame_end: int):
    """Bake follow animation to keyframes."""
    pass

def preview_follow_motion(rig: FollowRig, frames: int):
    """Preview follow motion in viewport."""
    pass
```

**Tasks**:
1. Implement rig creation
2. Implement per-frame update
3. Implement keyframe baking
4. Implement viewport preview

---

### Plan 6.3-05: Integration & Presets

**Deliverable**: `configs/cinematic/follow/follow_presets.yaml`

```yaml
presets:
  # Documentary style
  documentary_handheld:
    mode: loose
    smoothing: 0.4
    dead_zone: [0.15, 0.15]
    max_speed: 1.5

  # Action movie
  action_tight:
    mode: tight
    smoothing: 0.2
    dead_zone: [0.05, 0.05]
    max_speed: 5.0

  # Sports broadcast
  sports_tracking:
    mode: anticipatory
    look_ahead_frames: 15
    dead_zone: [0.1, 0.1]
    max_speed: 8.0

  # Cinematic dolly feel
  cinematic_smooth:
    mode: elastic
    smoothing: 0.6
    dead_zone: [0.2, 0.2]
    max_speed: 2.0

  # Orbit around subject
  dramatic_orbit:
    mode: orbit
    orbit_speed: 0.5  # degrees per frame
    keep_distance: 4.0
```

**Tasks**:
1. Create preset file
2. Implement preset loader
3. Create examples for each mode
4. Update __init__.py exports

---

## Acceptance Criteria

- [ ] All 5 follow modes work correctly
- [ ] Dead zones prevent micro-movements
- [ ] Look-ahead creates smooth motion
- [ ] Max speed limits work
- [ ] Baked keyframes produce smooth animation
- [ ] Presets load correctly

---

## Files

```
lib/cinematic/
├── follow_types.py       # Data structures
├── follow_modes.py       # Following algorithms
├── follow_deadzone.py    # Dead zone system
└── follow_controller.py  # Main controller

configs/cinematic/follow/
└── follow_presets.yaml   # Follow presets
```
