---
phase: 08.2-obstacle-avoidance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - configs/cinematic/follow_cam/avoidance_presets.yaml
  - configs/cinematic/follow_cam/prediction_settings.yaml
autonomous: true

must_haves:
  truths:
    - "Camera avoidance behavior is configurable via YAML presets"
    - "Prediction settings are configurable via YAML"
    - "Presets include different operator behavior profiles"
  artifacts:
    - path: "configs/cinematic/follow_cam/avoidance_presets.yaml"
      provides: "Obstacle avoidance configuration presets"
      contains: "avoidance_presets"
    - path: "configs/cinematic/follow_cam/prediction_settings.yaml"
      provides: "Motion prediction configuration"
      contains: "prediction_settings"
  key_links:
    - from: "configs/cinematic/follow_cam/avoidance_presets.yaml"
      to: "lib/cinematic/follow_cam/collision.py"
      via: "preset_loader"
      pattern: "load_avoidance_preset"
---

<objective>
Create YAML configuration files for obstacle avoidance and motion prediction systems.

Purpose: Externalize collision detection, obstacle response, and prediction settings for runtime configuration without code changes.
Output: Two YAML preset files with comprehensive configuration options.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS_FOLLOW_CAMERA.md

# Existing code references
@lib/cinematic/follow_cam/types.py
@lib/cinematic/follow_cam/collision.py
@lib/cinematic/follow_cam/prediction.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create avoidance_presets.yaml</name>
  <files>configs/cinematic/follow_cam/avoidance_presets.yaml</files>
  <action>
Create a comprehensive YAML configuration file for obstacle avoidance settings.

The file must include:

1. **collision_detection section**:
   - raycast: enabled, resolution (3x3 grid), max_distance
   - spherecast: enabled, radius, max_distance
   - frustum_check: enabled, check_occlusion
   - layers: ["geometry", "dynamic", "foliage"]
   - ignore: subject, transparent patterns, trigger patterns

2. **obstacle_response section**:
   - between_camera_and_subject: responses with conditions
     - push_forward: condition (distance < 5), min_distance
     - orbit_away: condition (can_orbit), angle (45 deg)
     - raise_up: condition (can_raise), max_height
     - zoom_through: condition (transparent_obstacle)
   - camera_backing: action (push_forward), min_distance (0.5)
   - camera_side: action (slide_away), slide_distance
   - smoothing: position, rotation, avoid_jitter (true)

3. **prediction_avoidance section**:
   - enabled, frames_ahead (30), sample_rate (5)
   - pre_avoid: enabled, start_distance (3.0), blend_duration (0.5)

4. **occlusion_handling section**:
   - on_occlusion: detection method, sample_points (9)
   - response priority: reposition_camera, push_through, cut_away
   - on_partial_occlusion: threshold (0.5), action

5. **operator_behavior section** (per REQ-FOLLOW-AVOID):
   - human_like:
     - reaction_delay: 0.1 seconds
     - angle_preference: horizontal [-45, 45], vertical [10, 30]
     - avoid_jerky_motion: true
     - min_movement_time: 0.3 seconds
     - breathing: enabled, amplitude (0.01m), frequency (0.25 Hz)
   - decision weights: visibility (1.0), composition (0.7), smoothness (0.5), distance (0.3)

6. **Named presets**:
   - default: balanced settings
   - aggressive: fast response, tighter margins
   - cautious: slow response, larger margins
   - cinematic: human-like operator behavior
   - game: fast, no breathing, priority on visibility

Reference the existing types.py for ObstacleResponse enum values: push_forward, orbit_away, raise_up, zoom_through, back_away.
  </action>
  <verify>
    - File exists at configs/cinematic/follow_cam/avoidance_presets.yaml
    - Contains all 6 required sections
    - Contains at least 5 named presets
    - YAML is valid (can be parsed)
  </verify>
  <done>
    avoidance_presets.yaml created with collision detection, obstacle response, prediction avoidance, occlusion handling, operator behavior, and 5 presets.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create prediction_settings.yaml</name>
  <files>configs/cinematic/follow_cam/prediction_settings.yaml</files>
  <action>
Create a comprehensive YAML configuration file for motion prediction settings.

The file must include:

1. **trajectory_prediction section**:
   - enabled: true
   - methods:
     - velocity: enabled, frames (30)
     - path: enabled, path_object (null)
     - animation: enabled, read_ahead (true)
     - physics: enabled, simulation_steps (30)
   - blend_method: "weighted"
   - weights: velocity (0.5), animation (0.5)

2. **look_ahead section** (per REQ-FOLLOW-PREDICT):
   - enabled: true
   - time_ahead: 0.5 seconds
   - blend_factor: 0.3
   - apply_to: position (true), rotation (true), fov (false)
   - smoothing: 0.2
   - corners:
     - enabled: true
     - detect_path_change: true
     - early_turn_factor: 0.3

3. **speed_anticipation section**:
   - enabled: true
   - behaviors:
     - accelerating: distance_multiplier (1.2), fov_increase (5)
     - decelerating: distance_multiplier (0.9), fov_decrease (3)
     - turning: distance_multiplier (1.1), orbit_bias ("outside")

4. **prediction_modes** (named presets):
   - default: balanced prediction
   - aggressive: longer look-ahead, higher confidence
   - conservative: shorter look-ahead, lower blend
   - vehicle: optimized for car/vehicle following with corner prediction
   - character: optimized for character following with animation prediction
   - disabled: prediction off

5. **corner_prediction section**:
   - enabled: true
   - detection_window_frames: 5
   - angle_threshold_degrees: 30
   - prediction_smoothing: 0.15
   - early_turn_enabled: true

Reference the existing prediction.py for PredictionResult fields and MotionPredictor parameters.
  </action>
  <verify>
    - File exists at configs/cinematic/follow_cam/prediction_settings.yaml
    - Contains all 5 required sections
    - Contains at least 6 named prediction modes
    - YAML is valid (can be parsed)
  </verify>
  <done>
    prediction_settings.yaml created with trajectory prediction, look-ahead, speed anticipation, corner prediction, and 6 modes.
  </done>
</task>

</tasks>

<verification>
1. Both YAML files exist in configs/cinematic/follow_cam/
2. Files contain all required sections from requirements
3. YAML syntax is valid
4. Settings align with existing types.py enums and dataclasses
</verification>

<success_criteria>
- avoidance_presets.yaml with collision detection, obstacle response, and operator behavior configs
- prediction_settings.yaml with trajectory, look-ahead, and speed anticipation configs
- All settings reference existing code structures
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-obstacle-avoidance/08.2-01-SUMMARY.md`
</output>
