---
phase: 08.2-obstacle-avoidance
plan: 03
type: execute
wave: 3
depends_on:
  - 08.2-02
files_modified:
  - tests/unit/test_follow_cam_operator.py
  - lib/cinematic/follow_cam/__init__.py
autonomous: true

must_haves:
  truths:
    - "Operator behavior functions are tested and pass"
    - "Oscillation prevention is tested and pass"
    - "All new functions are exported from package"
    - "Tests cover edge cases and boundary conditions"
  artifacts:
    - path: "tests/unit/test_follow_cam_operator.py"
      provides: "Unit tests for operator behavior and oscillation"
      contains: "TestOperatorBehavior, TestOscillationPreventer"
    - path: "lib/cinematic/follow_cam/__init__.py"
      provides: "Package exports for new APIs"
      contains: "OperatorBehavior, OscillationPreventer"
  key_links:
    - from: "test_follow_cam_operator.py"
      to: "lib/cinematic/follow_cam/collision.py"
      via: "unit test imports"
      pattern: "apply_operator_behavior"
---

<objective>
Create comprehensive unit tests for operator behavior and oscillation prevention, and update package exports.

Purpose: Ensure new operator behavior functionality is thoroughly tested and accessible via package imports.
Output: New test file for operator behavior, updated __init__.py with exports.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Code to test
@lib/cinematic/follow_cam/types.py
@lib/cinematic/follow_cam/collision.py
@lib/cinematic/follow_cam/prediction.py

# Existing tests for reference
@tests/unit/test_follow_cam_collision.py
@tests/unit/test_follow_cam_prediction.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create test_follow_cam_operator.py</name>
  <files>tests/unit/test_follow_cam_operator.py</files>
  <action>
Create comprehensive unit tests for the new operator behavior functionality.

The test file must include:

**TestOperatorBehavior class:**
- test_default_values: Verify defaults match requirements
- test_custom_values: Verify all fields can be customized
- test_to_dict: Verify serialization
- test_from_dict: Verify deserialization
- test_decision_weights_normalization: Weights should be normalizable

**TestOscillationPreventer class:**
- test_initialization: Default and custom parameters
- test_record_position: Position history builds correctly
- test_no_oscillation_straight_line: No oscillation detected for straight motion
- test_oscillation_detected_back_forth: Oscillation detected for rapid changes
- test_damping_applied_when_oscillating: Damping reduces movement
- test_damping_recovered_when_stable: Damping decreases after stable motion
- test_reset: State clears correctly
- test_minimum_damping: Never drops below minimum (0.3)

**TestApplyOperatorBehavior class:**
- test_breathing_offset_produced: Small offset added
- test_angle_preference_biases_position: Position moves toward preferred range
- test_reaction_delay_applied: Deferred response behavior
- test_combined_behavior: All behaviors work together
- test_no_oscillation_with_preventer: Oscillation preventer smooths output

**TestCalculateBreathingOffset class:**
- test_breathing_amplitude_respected: Offset within amplitude
- test_breathing_frequency: Changes over time correctly
- test_breathing_disabled: No offset when disabled

**TestApplyAnglePreference class:**
- test_horizontal_preference: Biases toward preferred horizontal range
- test_vertical_preference: Biases toward preferred vertical range
- test_outside_preference_moved: Position outside range moves toward range
- test_inside_preference_minimal_change: Position in range changes little

Use pytest patterns from existing test_follow_cam_collision.py and test_follow_cam_prediction.py.
Use lib.oracle for numeric and vector comparisons.
  </action>
  <verify>
    - File exists at tests/unit/test_follow_cam_operator.py
    - All 5 test classes exist
    - At least 20 test methods total
    - Tests run: python -m pytest tests/unit/test_follow_cam_operator.py -v
    - All tests pass
  </verify>
  <done>
    test_follow_cam_operator.py created with tests for OperatorBehavior, OscillationPreventer, apply_operator_behavior, breathing, and angle preference.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update __init__.py with new exports</name>
  <files>lib/cinematic/follow_cam/__init__.py</files>
  <action>
Update the package __init__.py to export the new types and functions.

Add to imports:
```python
from .types import (
    # ... existing ...
    OperatorBehavior,  # NEW
)

from .prediction import (
    # ... existing ...
    OscillationPreventer,  # NEW
    OscillationState,  # NEW
)

from .collision import (
    # ... existing ...
    apply_operator_behavior,  # NEW
    calculate_breathing_offset,  # NEW
    apply_angle_preference,  # NEW
)
```

Add to __all__:
```python
__all__ = [
    # ... existing ...

    # Operator behavior
    "OperatorBehavior",
    "OscillationPreventer",
    "OscillationState",
    "apply_operator_behavior",
    "calculate_breathing_offset",
    "apply_angle_preference",
]
```

Verify the docstring is updated to include usage examples for operator behavior.
  </action>
  <verify>
    - __init__.py updated with new imports
    - __all__ list includes all new exports
    - Package imports work: python -c "from lib.cinematic.follow_cam import OperatorBehavior, OscillationPreventer, apply_operator_behavior; print('OK')"
    - Module docstring references operator behavior
  </verify>
  <done>
    __init__.py updated with OperatorBehavior, OscillationPreventer, and new collision functions exported.
  </done>
</task>

<task type="auto">
  <name>Task 3: Run all follow_cam tests to verify integration</name>
  <files>None (verification task)</files>
  <action>
Run the complete follow_cam test suite to ensure all components work together.

Execute:
```bash
cd /Users/bretbouchard/apps/blender_gsd
python -m pytest tests/unit/test_follow_cam_*.py -v --tb=short
```

Verify:
1. All collision tests pass (test_follow_cam_collision.py)
2. All prediction tests pass (test_follow_cam_prediction.py)
3. All operator tests pass (test_follow_cam_operator.py)
4. No import errors
5. No regressions in existing tests

If any tests fail, identify and fix the issue before marking complete.
  </action>
  <verify>
    - All follow_cam tests pass
    - No import errors
    - Total test count reported
    - Coverage summary if available
  </verify>
  <done>
    All follow_cam unit tests pass (collision, prediction, operator).
  </done>
</task>

</tasks>

<verification>
1. test_follow_cam_operator.py exists with comprehensive tests
2. All tests pass
3. __init__.py exports new types/functions
4. Package imports work correctly
5. No regressions in existing tests
</verification>

<success_criteria>
- 20+ new test methods for operator behavior
- All follow_cam tests pass
- New types exported from package
- No import errors
</success_criteria>

<output>
After completion, create `.planning/phases/08.2-obstacle-avoidance/08.2-03-SUMMARY.md`
</output>
