---
phase: 06.6-render-system
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - lib/cinematic/types.py
  - lib/cinematic/enums.py
  - lib/cinematic/preset_loader.py
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Render settings can be loaded from quality_profiles.yaml"
    - "Render pass groups can be loaded from pass_presets.yaml"
    - "EXR settings can be loaded for multi-pass output configuration"
    - "CinematicRenderSettings extends RenderSettings with pass and quality support"
  artifacts:
    - path: "lib/cinematic/types.py"
      provides: "CinematicRenderSettings dataclass with pass/quality/exr support"
      min_lines: 50
    - path: "lib/cinematic/enums.py"
      provides: "RenderEngine, DenoiserType, EXRCompression enums"
    - path: "lib/cinematic/preset_loader.py"
      provides: "get_quality_profile, get_pass_preset, get_exr_settings functions"
  key_links:
    - from: "lib/cinematic/preset_loader.py"
      to: "configs/cinematic/render/quality_profiles.yaml"
      via: "load_preset()"
      pattern: "quality_profiles"
    - from: "lib/cinematic/preset_loader.py"
      to: "configs/cinematic/render/pass_presets.yaml"
      via: "load_preset()"
      pattern: "pass_presets"
---

<objective>
Extend types.py with CinematicRenderSettings dataclass and add render preset loaders to preset_loader.py

Purpose: Enable type-safe render configuration with quality tiers, pass groups, and EXR settings
Output: Extended types, enums, and preset loader functions for the render system
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing config files with preset data
@configs/cinematic/render/quality_profiles.yaml
@configs/cinematic/render/pass_presets.yaml

# Reference implementations
@lib/cinematic/types.py
@lib/cinematic/enums.py
@lib/cinematic/preset_loader.py

# Research findings
@.planning/phases/06.6-render-system/06.6-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Render Enums to enums.py</name>
  <files>lib/cinematic/enums.py</files>
  <action>
Add render-specific enums to lib/cinematic/enums.py following the existing enum pattern:

1. Add RenderEngine enum:
   - CYCLES = "CYCLES"
   - EEVEE_NEXT = "BLENDER_EEVEE_NEXT" (CRITICAL: Use this, not deprecated BLENDER_EEVEE)
   - WORKBENCH = "BLENDER_WORKBENCH"

2. Add DenoiserType enum:
   - OPTIX = "OPTIX" (NVIDIA GPUs)
   - OPEN_IMAGE_DENOISE = "OPENIMAGEDENOISE" (Apple Silicon, CPU)
   - NONE = "NONE"

3. Add EXRCompression enum:
   - DWAA = "DWAA" (lossy, fast)
   - ZIP = "ZIP" (lossless, balanced)
   - PIZ = "PIZ" (lossless, best compression)
   - NONE = "NONE"

Import these from the same location as existing enums (inheriting from str, Enum).

DO NOT modify existing enums. Add these after the existing ViewTransform and WorkingColorSpace enums.
  </action>
  <verify>python3 -c "from lib.cinematic.enums import RenderEngine, DenoiserType, EXRCompression; print(RenderEngine.CYCLES.value)"</verify>
  <done>RenderEngine, DenoiserType, EXRCompression enums available with correct Blender API values</done>
</task>

<task type="auto">
  <name>Task 2: Add CinematicRenderSettings Dataclass to types.py</name>
  <files>lib/cinematic/types.py</files>
  <action>
Add CinematicRenderSettings dataclass to lib/cinematic/types.py after the existing RenderSettings class:

```python
@dataclass
class CinematicRenderSettings:
    """
    Extended render configuration for cinematic profiles.

    Extends RenderSettings with pass groups, quality tiers, and EXR output.

    Attributes:
        engine: Render engine (CYCLES, BLENDER_EEVEE_NEXT, BLENDER_WORKBENCH)
        resolution_x: Horizontal resolution in pixels
        resolution_y: Vertical resolution in pixels
        samples: Render samples (Cycles only)
        quality_tier: Quality profile name from quality_profiles.yaml
        pass_group: Pass group name from pass_presets.yaml
        exr_preset: EXR settings preset name from pass_presets.yaml
        denoiser: Denoiser type (auto, OPTIX, OPENIMAGEDENOISE, none)
        film_transparent: Enable transparent background for compositing
        color_depth: EXR color depth (16, 32)
        compression: EXR compression codec (DWAA, ZIP, PIZ, NONE)
        frame_start: Animation start frame
        frame_end: Animation end frame
        fps: Frames per second
    """
    engine: str = "CYCLES"
    resolution_x: int = 2048
    resolution_y: int = 2048
    samples: int = 64
    quality_tier: str = "cycles_preview"
    pass_group: str = "product_minimal"
    exr_preset: str = "multi_layer_compositing"
    denoiser: str = "auto"  # auto, OPTIX, OPENIMAGEDENOISE, none
    film_transparent: bool = True
    color_depth: int = 32
    compression: str = "ZIP"
    frame_start: int = 1
    frame_end: int = 1
    fps: int = 24

    def to_dict(self) -> Dict[str, Any]:
        """Convert to dictionary for serialization."""
        return {
            "engine": self.engine,
            "resolution_x": self.resolution_x,
            "resolution_y": self.resolution_y,
            "samples": self.samples,
            "quality_tier": self.quality_tier,
            "pass_group": self.pass_group,
            "exr_preset": self.exr_preset,
            "denoiser": self.denoiser,
            "film_transparent": self.film_transparent,
            "color_depth": self.color_depth,
            "compression": self.compression,
            "frame_start": self.frame_start,
            "frame_end": self.frame_end,
            "fps": self.fps,
        }

    @classmethod
    def from_dict(cls, data: Dict[str, Any]) -> "CinematicRenderSettings":
        """Create from dictionary."""
        return cls(
            engine=data.get("engine", "CYCLES"),
            resolution_x=data.get("resolution_x", 2048),
            resolution_y=data.get("resolution_y", 2048),
            samples=data.get("samples", 64),
            quality_tier=data.get("quality_tier", "cycles_preview"),
            pass_group=data.get("pass_group", "product_minimal"),
            exr_preset=data.get("exr_preset", "multi_layer_compositing"),
            denoiser=data.get("denoiser", "auto"),
            film_transparent=data.get("film_transparent", True),
            color_depth=data.get("color_depth", 32),
            compression=data.get("compression", "ZIP"),
            frame_start=data.get("frame_start", 1),
            frame_end=data.get("frame_end", 1),
            fps=data.get("fps", 24),
        )
```

DO NOT modify the existing RenderSettings class. Add this as a new class after it.
  </action>
  <verify>python3 -c "from lib.cinematic.types import CinematicRenderSettings; s = CinematicRenderSettings(); print(s.quality_tier, s.pass_group)"</verify>
  <done>CinematicRenderSettings dataclass available with all required fields and serialization methods</done>
</task>

<task type="auto">
  <name>Task 3: Add Render Preset Loaders to preset_loader.py</name>
  <files>lib/cinematic/preset_loader.py</files>
  <action>
Add render configuration preset loaders to lib/cinematic/preset_loader.py following the existing pattern:

1. Add RENDER_CONFIG_ROOT constant after ANIMATION_CONFIG_ROOT:
```python
# Render configuration root directory
RENDER_CONFIG_ROOT = Path("configs/cinematic/render")
```

2. Add get_quality_profile() function (following get_turntable_preset pattern):
   - Load from RENDER_CONFIG_ROOT / "quality_profiles.yaml"
   - Get profiles section, raise ValueError if profile not found
   - Return the profile dict

3. Add get_pass_preset() function:
   - Load from RENDER_CONFIG_ROOT / "pass_presets.yaml"
   - Get pass_groups section, raise ValueError if group not found
   - Return the pass group dict

4. Add get_exr_settings() function:
   - Load from RENDER_CONFIG_ROOT / "pass_presets.yaml"
   - Get exr_settings section, raise ValueError if preset not found
   - Return the exr settings dict

5. Add list functions:
   - list_quality_profiles()
   - list_pass_presets()
   - list_exr_presets()

All functions should follow the exact pattern of existing loaders (error handling, docstrings, etc.).

Add these in a new section after the Animation System Preset Loaders section.
  </action>
  <verify>python3 -c "from lib.cinematic.preset_loader import get_quality_profile, get_pass_preset, get_exr_settings; print(get_quality_profile('cycles_preview')['engine'])"</verify>
  <done>get_quality_profile(), get_pass_preset(), get_exr_settings(), and list functions available for render configuration</done>
</task>

</tasks>

<verification>
1. Verify enums can be imported and have correct values
2. Verify CinematicRenderSettings can be instantiated and serialized
3. Verify preset loaders can read from existing YAML files
4. Verify list functions return expected preset names
</verification>

<success_criteria>
- RenderEngine, DenoiserType, EXRCompression enums in enums.py
- CinematicRenderSettings dataclass in types.py with all required fields
- get_quality_profile(), get_pass_preset(), get_exr_settings() in preset_loader.py
- All list_* functions return correct preset names
- All imports work without errors
</success_criteria>

<output>
After completion, create `.planning/phases/06.6-render-system/06.6-01-SUMMARY.md`
</output>
