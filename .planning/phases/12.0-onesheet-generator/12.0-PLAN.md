# Phase 12.0: Asset 1-Sheet Generator

**Goal**: Generate presentable 1-sheets from tracked assets with images and descriptions.

**Requirements**: `.planning/REQUIREMENTS_PRODUCTION_TRACKING.md` (REQ-ONESHEET-01)

**Depends On**: Phase 11.0 (Production Tracking)

**Duration**: 2-3 hours

---

## Overview

Turn tracking items into beautiful 1-sheets:
- Hero image + thumbnails
- Asset metadata (name, category, status)
- Description
- Source links
- Dependency chain
- Export to HTML, PDF, PNG

**Philosophy**: Every asset can have a 1-sheet. Generated from data, not hand-crafted.

---

## 1-Sheet Template

```
┌────────────────────────────────────────────────┐
│                                                │
│         [ HERO IMAGE - 800x450 ]               │
│                                                │
├────────────────────────────────────────────────┤
│                                                │
│  HERO CHARACTER                [Character] ✓   │
│  ID: CHAR-001                                  │
│                                                │
│  ──────────────────────────────────────────    │
│                                                │
│  Description:                                  │
│  Main protagonist of the story. A reluctant    │
│  hero who discovers hidden powers...           │
│                                                │
│  ──────────────────────────────────────────    │
│                                                │
│  [thumb1]  [thumb2]  [thumb3]  [thumb4]        │
│                                                │
│  ──────────────────────────────────────────    │
│                                                │
│  Dependencies:                                 │
│  → WARD-001: Hero Costume                      │
│  → PROP-015: Hero Weapon                       │
│                                                │
│  ──────────────────────────────────────────    │
│                                                │
│  Source: specs/characters/hero.md              │
│  Created: 2026-02-19 by bret                   │
│  Status: In Progress                           │
│                                                │
│  [QR Code]                     blender_gsd     │
│                                                │
└────────────────────────────────────────────────┘
```

---

## Architecture

```
tracking-ui/
├── src/
│   ├── onesheet/
│   │   ├── generator.ts       # 1-sheet generation logic
│   │   ├── templates/
│   │   │   ├── base.ts        # Base template
│   │   │   ├── character.ts   # Character-specific
│   │   │   ├── prop.ts        # Prop-specific
│   │   │   └── shot.ts        # Shot-specific
│   │   ├── export/
│   │   │   ├── html.ts        # HTML export
│   │   │   ├── pdf.ts         # PDF export (via print)
│   │   │   └── png.ts         # PNG export (via canvas)
│   │   └── styles/
│   │       └── onesheet.css   # 1-sheet specific styles
│   └── components/
│       └── OneSheetPreview.ts # Preview component

.gsd-state/
└── onesheets/
    ├── CHAR-001.html
    ├── CHAR-001.png
    └── ...
```

---

## Tasks

### Task 1: 1-Sheet Type Definitions
**File**: `tracking-ui/src/onesheet/types.ts`

```typescript
import type { TrackingItem } from '../types';

export interface OneSheetConfig {
  width: number;
  height: number;
  heroImageSize: { width: number; height: number };
  thumbSize: { width: number; height: number };
  showQRCode: boolean;
  showDependencies: boolean;
  theme: 'dark' | 'light';
}

export interface OneSheetData {
  item: TrackingItem;
  heroImage?: string;
  thumbnails: string[];
  dependencies: TrackingItem[];
  config: OneSheetConfig;
}

export const defaultConfig: OneSheetConfig = {
  width: 800,
  height: 1000,
  heroImageSize: { width: 800, height: 450 },
  thumbSize: { width: 180, height: 100 },
  showQRCode: true,
  showDependencies: true,
  theme: 'dark'
};
```

**Acceptance**: Types defined, compile without errors

---

### Task 2: Base Template
**File**: `tracking-ui/src/onesheet/templates/base.ts`

```typescript
import type { OneSheetData, OneSheetConfig } from '../types';
import { config } from '../../store';

export function generateBaseHTML(data: OneSheetData): string {
  const { item, heroImage, thumbnails, dependencies, config: cfg } = data;
  const appConfig = config.get();
  const category = appConfig?.categories.find(c => c.id === item.category);
  const status = appConfig?.statuses.find(s => s.id === item.status);

  return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>${item.name} - 1-Sheet</title>
  <style>
    ${generateStyles(cfg)}
  </style>
</head>
<body>
  <div class="onesheet" style="width: ${cfg.width}px; height: ${cfg.height}px;">
    ${heroImage ? `
      <div class="hero-image">
        <img src="${heroImage}" alt="${item.name}" />
      </div>
    ` : ''}

    <div class="content">
      <header class="header">
        <div class="title-block">
          <h1 class="name">${item.name}</h1>
          <span class="id">${item.id}</span>
        </div>
        <div class="badges">
          <span class="category" style="background: ${category?.color}">${category?.name}</span>
          <span class="status" style="background: ${status?.color}">${status?.name}</span>
        </div>
      </header>

      ${item.description ? `
        <section class="description">
          <h2>Description</h2>
          <p>${item.description}</p>
        </section>
      ` : ''}

      ${thumbnails.length > 0 ? `
        <section class="thumbnails">
          ${thumbnails.map(t => `
            <img src="${t}" class="thumb" alt="thumbnail" />
          `).join('')}
        </section>
      ` : ''}

      ${cfg.showDependencies && dependencies.length > 0 ? `
        <section class="dependencies">
          <h2>Dependencies</h2>
          <ul>
            ${dependencies.map(dep => `
              <li>
                <span class="dep-id">${dep.id}</span>
                <span class="dep-name">${dep.name}</span>
              </li>
            `).join('')}
          </ul>
        </section>
      ` : ''}

      <footer class="footer">
        <div class="source">
          <span>Source:</span>
          <a href="${item.source.spec}">${item.source.spec}</a>
        </div>
        <div class="meta">
          Created: ${item.source.created_at} by ${item.source.created_by}
        </div>
        ${cfg.showQRCode ? `
          <div class="qr-placeholder">
            [QR: ${item.id}]
          </div>
        ` : ''}
        <div class="project">blender_gsd</div>
      </footer>
    </div>
  </div>
</body>
</html>
  `;
}

function generateStyles(cfg: OneSheetConfig): string {
  const colors = cfg.theme === 'dark'
    ? { bg: '#1a1a2e', fg: '#eaeaea', muted: '#666', card: '#16213e', border: '#2a2a4a' }
    : { bg: '#ffffff', fg: '#1a1a2e', muted: '#666', card: '#f5f5f5', border: '#ddd' };

  return `
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: ${colors.bg};
      color: ${colors.fg};
      display: flex;
      justify-content: center;
      padding: 2rem;
    }

    .onesheet {
      background: ${colors.card};
      border: 1px solid ${colors.border};
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }

    .hero-image {
      width: 100%;
      height: ${cfg.heroImageSize.height}px;
      overflow: hidden;
    }

    .hero-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .content {
      padding: 1.5rem;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid ${colors.border};
    }

    .name {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }

    .id {
      font-family: monospace;
      font-size: 0.875rem;
      color: ${colors.muted};
    }

    .badges {
      display: flex;
      gap: 0.5rem;
    }

    .category, .status {
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      text-transform: uppercase;
      font-weight: 500;
    }

    .description {
      margin-bottom: 1.5rem;
    }

    .description h2 {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: ${colors.muted};
      margin-bottom: 0.5rem;
    }

    .description p {
      font-size: 0.875rem;
      line-height: 1.5;
    }

    .thumbnails {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      overflow-x: auto;
    }

    .thumb {
      width: ${cfg.thumbSize.width}px;
      height: ${cfg.thumbSize.height}px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid ${colors.border};
    }

    .dependencies {
      margin-bottom: 1.5rem;
    }

    .dependencies h2 {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: ${colors.muted};
      margin-bottom: 0.5rem;
    }

    .dependencies ul {
      list-style: none;
    }

    .dependencies li {
      padding: 0.5rem;
      background: ${colors.bg};
      border-radius: 4px;
      margin-bottom: 0.25rem;
      font-size: 0.875rem;
    }

    .dep-id {
      font-family: monospace;
      color: #3498db;
      margin-right: 0.5rem;
    }

    .footer {
      border-top: 1px solid ${colors.border};
      padding-top: 1rem;
      font-size: 0.75rem;
      color: ${colors.muted};
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      align-items: center;
    }

    .source a {
      color: #3498db;
      text-decoration: none;
    }

    .qr-placeholder {
      margin-left: auto;
      background: ${colors.bg};
      padding: 0.5rem;
      border-radius: 4px;
      font-family: monospace;
    }

    .project {
      width: 100%;
      text-align: center;
      margin-top: 0.5rem;
      font-weight: 500;
    }

    @media print {
      body { padding: 0; background: white; }
      .onesheet { box-shadow: none; border: none; }
    }
  `;
}
```

**Acceptance**: Template generates valid HTML

---

### Task 3: Category-Specific Templates
**File**: `tracking-ui/src/onesheet/templates/character.ts`

Characters might have additional fields like actor, costume, etc:

```typescript
import { generateBaseHTML } from './base';
import type { OneSheetData } from '../types';

export function generateCharacterHTML(data: OneSheetData): string {
  // Extend base template with character-specific sections
  // For now, just use base template
  return generateBaseHTML(data);
}
```

Similar files for `prop.ts`, `shot.ts`, etc.

**Acceptance**: Template router works

---

### Task 4: Template Router
**File**: `tracking-ui/src/onesheet/templates/index.ts`

```typescript
import type { OneSheetData } from '../types';
import { generateBaseHTML } from './base';
import { generateCharacterHTML } from './character';
import { generatePropHTML } from './prop';
import { generateShotHTML } from './shot';

const templates: Record<string, (data: OneSheetData) => string> = {
  character: generateCharacterHTML,
  prop: generatePropHTML,
  wardrobe: generateBaseHTML,
  set: generateBaseHTML,
  shot: generateShotHTML,
  asset: generateBaseHTML,
  audio: generateBaseHTML,
};

export function generateOneSheet(data: OneSheetData): string {
  const template = templates[data.item.category] || generateBaseHTML;
  return template(data);
}
```

**Acceptance**: Router selects correct template

---

### Task 5: HTML Export
**File**: `tracking-ui/src/onesheet/export/html.ts`

```typescript
import type { OneSheetData } from '../types';
import { generateOneSheet } from '../templates';

export function exportHTML(data: OneSheetData): string {
  return generateOneSheet(data);
}

export function downloadHTML(data: OneSheetData): void {
  const html = exportHTML(data);
  const blob = new Blob([html], { type: 'text/html' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = `${data.item.id}.html`;
  a.click();

  URL.revokeObjectURL(url);
}

export function saveToState(data: OneSheetData): string {
  // In a real implementation, this would write to .gsd-state/onesheets/
  // For now, we just return the path it would be saved to
  return `.gsd-state/onesheets/${data.item.id}.html`;
}
```

**Acceptance**: HTML export downloads file

---

### Task 6: PDF Export (via Print)
**File**: `tracking-ui/src/onesheet/export/pdf.ts`

PDF generation via browser print:

```typescript
import type { OneSheetData } from '../types';
import { generateOneSheet } from '../templates';

export function exportPDF(data: OneSheetData): void {
  const html = generateOneSheet(data);

  // Open in new window for printing
  const printWindow = window.open('', '_blank');
  if (!printWindow) {
    alert('Please allow popups to print 1-sheets');
    return;
  }

  printWindow.document.write(html);
  printWindow.document.close();

  // Wait for images to load
  printWindow.onload = () => {
    printWindow.print();
  };
}
```

**Acceptance**: Print dialog opens with 1-sheet

---

### Task 7: PNG Export (via Canvas)
**File**: `tracking-ui/src/onesheet/export/png.ts`

Use html2canvas or similar:

```typescript
import type { OneSheetData } from '../types';

// Note: Requires html2canvas library
// npm install html2canvas

export async function exportPNG(element: HTMLElement, filename: string): Promise<void> {
  // Dynamic import to avoid bundling if not used
  const html2canvas = (await import('html2canvas')).default;

  const canvas = await html2canvas(element, {
    backgroundColor: '#1a1a2e',
    scale: 2, // High DPI
  });

  const url = canvas.toDataURL('image/png');

  const a = document.createElement('a');
  a.href = url;
  a.download = filename;
  a.click();
}

export async function exportOneSheetPNG(data: OneSheetData): Promise<void> {
  // This would render the 1-sheet to a hidden element, then capture
  console.log('PNG export for:', data.item.id);
  // Implementation depends on having a rendered element
}
```

**Acceptance**: PNG downloads correctly

---

### Task 8: Generator Service
**File**: `tracking-ui/src/onesheet/generator.ts`

```typescript
import type { TrackingItem, OneSheetData, OneSheetConfig } from './types';
import { defaultConfig } from './types';
import { items } from '../store';
import { exportHTML, downloadHTML } from './export/html';
import { exportPDF } from './export/pdf';

export class OneSheetGenerator {
  private config: OneSheetConfig;

  constructor(config: Partial<OneSheetConfig> = {}) {
    this.config = { ...defaultConfig, ...config };
  }

  generate(item: TrackingItem): OneSheetData {
    const allItems = items.get();

    // Resolve dependencies
    const dependencies = item.depends_on
      .map(id => allItems.find(i => i.id === id))
      .filter(Boolean) as TrackingItem[];

    // Determine hero image (first image or placeholder)
    const heroImage = item.images[0];

    // Thumbnails (remaining images, up to 4)
    const thumbnails = item.images.slice(1, 5);

    return {
      item,
      heroImage,
      thumbnails,
      dependencies,
      config: this.config
    };
  }

  generateHTML(item: TrackingItem): string {
    const data = this.generate(item);
    return exportHTML(data);
  }

  downloadHTML(item: TrackingItem): void {
    const data = this.generate(item);
    downloadHTML(data);
  }

  printPDF(item: TrackingItem): void {
    const data = this.generate(item);
    exportPDF(data);
  }
}

// Singleton instance
export const onesheet = new OneSheetGenerator();
```

**Acceptance**: Generator works end-to-end

---

### Task 9: Preview Component
**File**: `tracking-ui/src/components/OneSheetPreview.ts`

```typescript
import type { TrackingItem } from '../types';
import { onesheet } from '../onesheet/generator';

export function OneSheetPreview(item: TrackingItem): HTMLElement {
  const container = document.createElement('div');
  container.className = 'onesheet-preview';

  const html = onesheet.generateHTML(item);

  // Render preview in iframe
  const iframe = document.createElement('iframe');
  iframe.srcdoc = html;
  iframe.className = 'preview-frame';

  const actions = document.createElement('div');
  actions.className = 'preview-actions';
  actions.innerHTML = `
    <button class="btn-download-html">Download HTML</button>
    <button class="btn-print-pdf">Print PDF</button>
    <button class="btn-close">Close</button>
  `;

  actions.querySelector('.btn-download-html')?.addEventListener('click', () => {
    onesheet.downloadHTML(item);
  });

  actions.querySelector('.btn-print-pdf')?.addEventListener('click', () => {
    onesheet.printPDF(item);
  });

  actions.querySelector('.btn-close')?.addEventListener('click', () => {
    container.remove();
  });

  container.appendChild(iframe);
  container.appendChild(actions);

  return container;
}

// Add to item card click handler
export function showOneSheetPreview(item: TrackingItem): void {
  const existing = document.querySelector('.onesheet-modal');
  if (existing) existing.remove();

  const modal = document.createElement('div');
  modal.className = 'onesheet-modal';
  modal.appendChild(OneSheetPreview(item));

  document.body.appendChild(modal);
}
```

**Acceptance**: Preview modal shows 1-sheet

---

### Task 10: Integration with Tracking Board
**File**: Updates to `tracking-ui/src/components/ItemCard.ts`

Add 1-sheet button to item cards:

```typescript
// In ItemCard, add:
const onesheetBtn = document.createElement('button');
onesheetBtn.className = 'btn-onesheet';
onesheetBtn.textContent = '1-Sheet';
onesheetBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  showOneSheetPreview(item);
});
card.appendChild(onesheetBtn);
```

**Acceptance**: 1-sheet button works from board

---

### Task 11: Batch Generation
**File**: `tracking-ui/src/onesheet/batch.ts`

Generate 1-sheets for all items:

```typescript
import { items } from '../store';
import { onesheet } from './generator';
import { exportHTML } from './export/html';

export interface BatchResult {
  id: string;
  status: 'success' | 'error';
  path?: string;
  error?: string;
}

export async function generateAllOneSheets(): Promise<BatchResult[]> {
  const allItems = items.get();
  const results: BatchResult[] = [];

  for (const item of allItems) {
    try {
      const html = onesheet.generateHTML(item);
      // In a real implementation, write to .gsd-state/onesheets/
      // For now, just report success
      results.push({
        id: item.id,
        status: 'success',
        path: `.gsd-state/onesheets/${item.id}.html`
      });
    } catch (error) {
      results.push({
        id: item.id,
        status: 'error',
        error: String(error)
      });
    }
  }

  return results;
}
```

**Acceptance**: Batch generation works

---

## Acceptance Criteria

### Must Have
- [ ] Generate HTML 1-sheet from tracking item
- [ ] Hero image + thumbnails display
- [ ] Metadata (name, category, status) display
- [ ] Description section
- [ ] Source link
- [ ] Dependency list
- [ ] Download HTML
- [ ] Print to PDF

### Nice to Have
- [ ] QR code with item ID
- [ ] Category-specific templates
- [ ] Dark/light theme toggle
- [ ] PNG export
- [ ] Batch generation

---

## Out of Scope (Future Phases)
- Product shot auto-generation (Phase 10.1)
- Blender render integration (Phase 10.1)

---

## Dependencies

```json
{
  "dependencies": {
    "html2canvas": "^1.4.0"
  }
}
```

---

## Commands

```bash
# Generate 1-sheet for single item
# (via UI button click)

# Batch generate all 1-sheets
# (via UI button or API)
```
