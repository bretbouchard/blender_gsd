---
phase: 08.1-follow-modes
plan: 03
type: execute
wave: 3
depends_on: ["08.1-01", "08.1-02"]
files_modified:
  - lib/cinematic/follow_cam/transitions.py
  - lib/cinematic/follow_cam/__init__.py
  - tests/unit/test_follow_modes.py
autonomous: true

must_haves:
  truths:
    - "Cut transitions switch modes instantly"
    - "Blend transitions smoothly interpolate between modes"
    - "Orbit transitions rotate camera to new position"
    - "Dolly transitions physically move camera"
    - "Unit tests verify all 8 modes produce valid output"
  artifacts:
    - path: "lib/cinematic/follow_cam/transitions.py"
      provides: "Mode transition implementations"
      exports: ["TransitionState", "TransitionManager", "calculate_transition_position"]
      min_lines: 300
    - path: "lib/cinematic/follow_cam/__init__.py"
      provides: "Package exports"
      contains: "__all__"
    - path: "tests/unit/test_follow_modes.py"
      provides: "Unit tests for follow modes"
      contains: "def test_"
  key_links:
    - from: "TransitionManager"
      to: "TransitionType"
      via: "transition type dispatch"
      pattern: "TransitionType\\."
    - from: "__init__.py"
      to: "types.py, follow_modes.py, transitions.py"
      via: "import"
      pattern: "from \\."
---

<objective>
Implement mode transitions and unit tests for follow camera system.

Purpose: Create smooth transitions between camera modes and comprehensive tests to verify all 8 follow modes work correctly.

Output: Working transition system and unit test coverage for follow modes.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS_FOLLOW_CAMERA.md

# Dependencies
@.planning/phases/08.1-follow-modes/08.1-01-SUMMARY.md
@.planning/phases/08.1-follow-modes/08.1-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Mode Transition System</name>
  <files>lib/cinematic/follow_cam/transitions.py</files>
  <action>
Create mode transition system in `lib/cinematic/follow_cam/transitions.py`:

1. **TransitionState dataclass**:
   - start_position, start_yaw, start_pitch
   - end_position, end_yaw, end_pitch
   - start_mode, end_mode
   - progress (0.0 to 1.0)
   - duration (seconds)
   - elapsed_time

2. **TransitionManager class**:
   - active_transition: Optional[TransitionState]
   - start_transition(from_state, to_config, duration, transition_type)
   - update(delta_time) -> returns current interpolated state
   - is_active() -> bool
   - get_current_state() -> CameraState

3. **Transition calculation functions**:
   - **create_instant_transition()** - Cut: Returns end state immediately
   - **create_smooth_transition()** - Blend: Linear interpolation with easing
   - **create_orbit_transition()** - Orbit: Rotates around subject to new position
   - **create_dolly_transition()** - Dolly: Linear path from start to end

4. **calculate_transition_position(state, progress)**:
   - Main interpolation function
   - Handles position, yaw (with angle wrapping), pitch
   - Returns interpolated (position, yaw, pitch)

Use easing functions for smooth transitions (ease_in_out_cubic or similar).
  </action>
  <verify>
    python3 -c "from lib.cinematic.follow_cam.transitions import TransitionManager, TransitionType; print('Transitions OK')"
  </verify>
  <done>
All 4 transition types implemented, TransitionManager handles active transitions
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Package Exports</name>
  <files>lib/cinematic/follow_cam/__init__.py</files>
  <action>
Update `lib/cinematic/follow_cam/__init__.py` with all exports:

**From types.py**:
- FollowMode, LockedPlane, ObstacleResponse, TransitionType
- FollowTarget, ObstacleInfo, FollowCameraConfig, CameraState

**From follow_modes.py**:
- calculate_ideal_position, smooth_position, smooth_angle
- calculate_camera_rotation, get_target_forward_direction

**From transitions.py**:
- TransitionState, TransitionManager
- calculate_transition_position
- create_instant_transition, create_smooth_transition
- create_orbit_transition, create_dolly_transition

Create comprehensive __all__ list with all exports.
Add module docstring explaining the follow camera system.
Include usage example in docstring.
  </action>
  <verify>
    python3 -c "from lib.cinematic.follow_cam import FollowMode, calculate_ideal_position, TransitionManager; print('Exports OK')"
  </verify>
  <done>
All types, functions, and classes exported from __init__.py
  </done>
</task>

<task type="auto">
  <name>Task 3: Create Follow Modes Unit Tests</name>
  <files>tests/unit/test_follow_modes.py</files>
  <action>
Create comprehensive unit tests in `tests/unit/test_follow_modes.py`:

**Test class: TestFollowModeTypes**
- test_follow_mode_enum_has_8_values()
- test_locked_plane_enum_values()
- test_transition_type_enum_values()
- test_follow_camera_config_defaults()
- test_follow_camera_config_serialization()
- test_follow_target_from_dict()

**Test class: TestFollowModeCalculations**
- test_side_scroller_xz_plane() - Verify Y is locked
- test_side_scroller_xy_plane() - Verify Z is locked
- test_over_shoulder_right_offset() - Positive offset = right
- test_over_shoulder_left_offset() - Negative offset = left
- test_chase_speed_distance() - Higher speed = more distance
- test_chase_side_positioning() - Verify side offset
- test_orbit_follow_rotation() - Verify angle changes over time
- test_lead_ahead_positioning() - Verify camera ahead of target
- test_aerial_top_down() - Verify pitch near -90
- test_free_roam_default() - Verify basic positioning

**Test class: TestSmoothing**
- test_smooth_position_zero_smoothing() - No smoothing = instant
- test_smooth_position_full_smoothing() - High smoothing = gradual
- test_smooth_angle_wrapping() - 350 -> 10 should go through 0

**Test class: TestTransitions**
- test_instant_transition() - Returns end state
- test_smooth_transition_progress() - Linear interpolation
- test_orbit_transition_arc() - Arc path between positions

Use pytest fixtures for common test configurations.
  </action>
  <verify>
    cd /Users/bretbouchard/apps/blender_gsd && python3 -m pytest tests/unit/test_follow_modes.py -v --tb=short 2>&1 | head -50
  </verify>
  <done>
All tests pass, covering types, all 8 modes, smoothing, and transitions
  </done>
</task>

</tasks>

<verification>
1. TransitionManager handles all 4 transition types
2. Package exports all required symbols
3. Unit tests cover all 8 follow modes
4. Tests pass without Blender (using fallback classes)
</verification>

<success_criteria>
- 4 transition types (cut, blend, orbit, dolly) implemented
- __all__ contains 30+ exports
- 15+ unit tests passing
- Tests run outside Blender environment
</success_criteria>

<output>
After completion, create `.planning/phases/08.1-follow-modes/08.1-03-SUMMARY.md`
</output>
